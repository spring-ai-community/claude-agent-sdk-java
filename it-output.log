[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Build Order:
[INFO] 
[INFO] Claude Agent SDK Parent                                            [pom]
[INFO] Claude Code SDK                                                    [jar]
[INFO] Claude Code SDK Examples                                           [pom]
[INFO] Claude Code SDK Hello World Example                                [jar]
[INFO] 
[INFO] -----------< org.springaicommunity:claude-agent-sdk-parent >------------
[INFO] Building Claude Agent SDK Parent 1.0.0-SNAPSHOT                    [1/4]
[INFO]   from pom.xml
[INFO] --------------------------------[ pom ]---------------------------------
[INFO] 
[INFO] --- flatten:1.5.0:flatten (flatten) @ claude-agent-sdk-parent ---
[INFO] Generating flattened POM of project org.springaicommunity:claude-agent-sdk-parent:pom:1.0.0-SNAPSHOT...
[INFO] 
[INFO] --- compiler:3.11.0:compile (java-compile) @ claude-agent-sdk-parent ---
[INFO] No sources to compile
[INFO] 
[INFO] --- compiler:3.11.0:testCompile (java-test-compile) @ claude-agent-sdk-parent ---
[INFO] No sources to compile
[INFO] 
[INFO] >>> source:3.3.0:jar (generate-sources) > generate-sources @ claude-agent-sdk-parent >>>
[INFO] 
[INFO] <<< source:3.3.0:jar (generate-sources) < generate-sources @ claude-agent-sdk-parent <<<
[INFO] 
[INFO] 
[INFO] --- source:3.3.0:jar (generate-sources) @ claude-agent-sdk-parent ---
[INFO] 
[INFO] ---------------< org.springaicommunity:claude-code-sdk >----------------
[INFO] Building Claude Code SDK 1.0.0-SNAPSHOT                            [2/4]
[INFO]   from claude-code-sdk/pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- jacoco:0.8.11:prepare-agent (prepare-agent) @ claude-code-sdk ---
[INFO] argLine set to -javaagent:/home/mark/.m2/repository/org/jacoco/org.jacoco.agent/0.8.11/org.jacoco.agent-0.8.11-runtime.jar=destfile=/home/mark/community/claude-agent-sdk-java/claude-code-sdk/target/jacoco.exec
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ claude-code-sdk ---
[INFO] skip non existing resourceDirectory /home/mark/community/claude-agent-sdk-java/claude-code-sdk/src/main/resources
[INFO] 
[INFO] --- flatten:1.5.0:flatten (flatten) @ claude-code-sdk ---
[INFO] Generating flattened POM of project org.springaicommunity:claude-code-sdk:jar:1.0.0-SNAPSHOT...
[INFO] 
[INFO] --- compiler:3.11.0:compile (java-compile) @ claude-code-sdk ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ claude-code-sdk ---
[INFO] skip non existing resourceDirectory /home/mark/community/claude-agent-sdk-java/claude-code-sdk/src/test/resources
[INFO] 
[INFO] --- compiler:3.11.0:testCompile (java-test-compile) @ claude-code-sdk ---
[INFO] Changes detected - recompiling the module! :source
[INFO] Compiling 27 source files with javac [debug release 17] to target/test-classes
[INFO] /home/mark/community/claude-agent-sdk-java/claude-code-sdk/src/test/java/org/springaicommunity/claude/agent/sdk/ClaudeCliApiIT.java: Some input files use or override a deprecated API.
[INFO] /home/mark/community/claude-agent-sdk-java/claude-code-sdk/src/test/java/org/springaicommunity/claude/agent/sdk/ClaudeCliApiIT.java: Recompile with -Xlint:deprecation for details.
[INFO] 
[INFO] --- surefire:3.1.2:test (default-test) @ claude-code-sdk ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests
11:10:07.068 [main] DEBUG reactor.util.Loggers -- Using Slf4j logging framework
11:10:07.129 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.141 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.143 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.145 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.147 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.149 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.152 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[INFO] Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.250 s -- in org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests.buildCommandWithAllAdvancedOptions -- Time elapsed: 0.226 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests.buildCommandWithUser -- Time elapsed: 0.003 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests.buildCommandWithPermissionPromptToolName -- Time elapsed: 0.004 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests.buildCommandWithExtraArgsWithValue -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests.buildCommandWithSettings -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests.buildCommandWithExtraArgsBooleanFlag -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests.buildCommandWithAddDirs -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$AdvancedOptionsTests.buildCommandWithPlugins -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BidirectionalModeVerification
11:10:07.157 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.159 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.162 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.008 s -- in org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BidirectionalModeVerification
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BidirectionalModeVerification.commandEnablesBidirectionalMode -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BidirectionalModeVerification.shouldNotIncludePrintInBidirectionalMode -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BidirectionalModeVerification.alwaysIncludesVerbose -- Time elapsed: 0.002 s
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BudgetControlTests
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.021 s -- in org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BudgetControlTests
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BudgetControlTests.buildCommandWithMaxTurns -- Time elapsed: 0.003 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BudgetControlTests.buildCommandWithMaxBudgetUsd -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BudgetControlTests.buildCommandWithAllBudgetOptions -- Time elapsed: 0.004 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BudgetControlTests.buildCommandWithFallbackModel -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$BudgetControlTests.buildCommandWithAppendSystemPrompt -- Time elapsed: 0.002 s
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$TransportStateTests
11:10:07.194 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [claude, --version].
11:10:07.202 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=8335, exitValue="not exited"]
11:10:07.438 [WaitForProcess-Process[pid=8335, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=8335, exitValue=0] stopped with exit code 0
11:10:07.439 [main] DEBUG org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscovery -- Found Claude CLI at claude with version: 2.0.65 (Claude Code)
11:10:07.439 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [which, claude].
11:10:07.440 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=8350, exitValue="not exited"]
11:10:07.440 [WaitForProcess-Process[pid=8350, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=8350, exitValue=0] stopped with exit code 0
11:10:07.440 [main] DEBUG org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscovery -- Resolved command 'claude' to full path: /home/mark/.local/bin/claude
11:10:07.440 [main] INFO org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscovery -- Claude CLI found at: /home/mark/.local/bin/claude
11:10:07.441 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.443 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.444 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:07.446 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.259 s -- in org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$TransportStateTests
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$TransportStateTests.closeWhenNotStarted -- Time elapsed: 0.252 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$TransportStateTests.notRunningInitially -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$TransportStateTests.customTimeout -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$TransportStateTests.customClaudePath -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests
[INFO] Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 s -- in org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.buildCommandWithSystemPrompt -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.buildCommandWithAllowedTools -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.buildCompleteCommand -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.buildCommandWithBidirectionalFlags -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.buildCommandWithDisallowedTools -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.shouldNotIncludePromptAsArgument -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.buildCommandWithModel -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.buildCommandWithPermissionMode -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest$CommandBuildingTests.buildCommandWithEmptyOptions -- Time elapsed: 0.001 s
[INFO] Tests run: 0, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.571 s -- in org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportTest
[INFO] Running org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest
[INFO] Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.078 s -- in org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest.stdioConfigConvenienceConstructor -- Time elapsed: 0.008 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest.isSdkServerReturnsTrueOnlyForSdkConfig -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest.stdioConfigSerialization -- Time elapsed: 0.054 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest.httpConfigSerialization -- Time elapsed: 0.004 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest.sdkConfigDoesNotSerializeInstance -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest.sseConfigSerialization -- Time elapsed: 0.004 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpServerConfigTest.typeMethodReturnsCorrectType -- Time elapsed: 0 s
[INFO] Running org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest
[INFO] Tests run: 20, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.018 s -- in org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.formatToolNameWithComplexNames -- Time elapsed: 0.003 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.extractToolNameReturnsToolName -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.parseToolNameReturnsNullForOnlyPrefix -- Time elapsed: 0.003 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.extractToolNameReturnsNullForNonMcpName -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.extractServerNameReturnsServerName -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.parseToolNameReturnsNullForMissingToolName -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.isMcpToolNameReturnsFalseForNonMcpName -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.parseToolNameWithComplexNames -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.formatToolNameThrowsOnNullServerName -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.parseToolNameWithToolContainingDoubleUnderscore -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.formatToolNameThrowsOnBlankServerName -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.parseToolNameReturnsServerAndTool -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.parseToolNameReturnsNullForNonMcpName -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.formatToolNameThrowsOnNullToolName -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.formatToolNameThrowsOnBlankToolName -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.isMcpToolNameReturnsTrueForValidMcpName -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.extractServerNameReturnsNullForNonMcpName -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.parseToolNameReturnsNullForNullInput -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.parseToolNameReturnsNullForMissingServerName -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.mcp.McpToolNamingTest.formatToolNameCreatesCorrectFormat -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest
[INFO] Running org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionContextTests
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s -- in org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionContextTests
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionContextTests.callbackUsesContext -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionContextTests.fullContext -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionContextTests.emptyContext -- Time elapsed: 0 s
[INFO] Running org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionCallbackTests
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 s -- in org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionCallbackTests
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionCallbackTests.denyAllCallback -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionCallbackTests.customInspectInputCallback -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionCallbackTests.allowAllCallback -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionCallbackTests.customDenyCallback -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$ToolPermissionCallbackTests.customModifyCallback -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$PermissionResultTests
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s -- in org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$PermissionResultTests
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$PermissionResultTests.allowWithoutModification -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$PermissionResultTests.allowWithModification -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$PermissionResultTests.denyWithoutMessage -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest$PermissionResultTests.denyWithMessage -- Time elapsed: 0.001 s
[INFO] Tests run: 0, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.013 s -- in org.springaicommunity.claude.agent.sdk.permission.ToolPermissionCallbackTest
[INFO] Running org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest
[INFO] Running org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookCallbackStaticMethodsTests
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s -- in org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookCallbackStaticMethodsTests
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookCallbackStaticMethodsTests.blockCallback -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookCallbackStaticMethodsTests.allowCallback -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$PatternMatchingTests
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 s -- in org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$PatternMatchingTests
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$PatternMatchingTests.matchPatternWithOr -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$PatternMatchingTests.matchExactToolName -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$PatternMatchingTests.nullPatternMatchesAll -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$PatternMatchingTests.matchWildcardPattern -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$InitializeRequestTests
11:10:07.583 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 s -- in org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$InitializeRequestTests
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$InitializeRequestTests.createInitializeRequest -- Time elapsed: 0.005 s
[INFO] Running org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests
11:10:07.588 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash|Write
11:10:07.589 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_1, event=PRE_TOOL_USE, pattern=Bash
11:10:07.590 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_2, event=PRE_TOOL_USE, pattern=Bash
11:10:07.591 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_bash, event=PRE_TOOL_USE, pattern=Bash
11:10:07.591 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_write, event=PRE_TOOL_USE, pattern=Write
11:10:07.592 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=null
11:10:07.592 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_1, event=POST_TOOL_USE, pattern=null
11:10:07.592 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_2, event=USER_PROMPT_SUBMIT, pattern=null
11:10:07.593 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=null
11:10:07.594 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_1, event=PRE_TOOL_USE, pattern=Bash
11:10:07.595 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_2, event=PRE_TOOL_USE, pattern=Bash
[INFO] Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.008 s -- in org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests.buildPreToolUseConfig -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests.maxTimeoutFromGroup -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests.separateHooksByPattern -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests.buildMultiEventConfig -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests.buildEmptyConfig -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests.wildcardPatternForAllTools -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookConfigBuildingTests.groupHooksByPattern -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookExecutionTests
11:10:07.597 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=null
11:10:07.597 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Executing hook: id=hook_0, event=PRE_TOOL_USE
11:10:07.597 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Hook result: id=hook_0, continue=true
11:10:07.598 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=null
11:10:07.598 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Executing hook: id=hook_0, event=PRE_TOOL_USE
11:10:07.598 [main] ERROR org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Hook execution failed: id=hook_0
java.lang.RuntimeException: Test error
	at org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookExecutionTests.lambda$handleCallbackException$1(HookRegistryTest.java:220)
	at org.springaicommunity.claude.agent.sdk.hooks.HookRegistry.executeHook(HookRegistry.java:253)
	at org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookExecutionTests.handleCallbackException(HookRegistryTest.java:227)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
11:10:07.604 [main] WARN org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Hook not found: non_existent
11:10:07.606 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=null
11:10:07.606 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Executing hook: id=hook_0, event=PRE_TOOL_USE
11:10:07.606 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Hook result: id=hook_0, continue=true
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 s -- in org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookExecutionTests
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookExecutionTests.executeCallback -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookExecutionTests.handleCallbackException -- Time elapsed: 0.003 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookExecutionTests.executeNonExistentHook -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookExecutionTests.passInputToCallback -- Time elapsed: 0.002 s
[INFO] Running org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests
11:10:07.609 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=POST_TOOL_USE, pattern=Read
11:10:07.611 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=STOP, pattern=null
11:10:07.612 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=null
11:10:07.612 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=USER_PROMPT_SUBMIT, pattern=null
11:10:07.613 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash|Write
11:10:07.614 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=my_hook, event=PRE_TOOL_USE, pattern=null
11:10:07.615 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=null
11:10:07.615 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_1, event=POST_TOOL_USE, pattern=null
11:10:07.615 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_2, event=STOP, pattern=null
11:10:07.615 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Cleared all hooks
11:10:07.617 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash
11:10:07.617 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_1, event=PRE_TOOL_USE, pattern=Write
11:10:07.617 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_2, event=POST_TOOL_USE, pattern=null
11:10:07.619 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=null
11:10:07.620 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Unregistered hook: id=hook_0
[INFO] Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 s -- in org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.registerPostToolUse -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.registerStop -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.registerPreToolUseForAllTools -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.registerUserPromptSubmit -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.registerPreToolUseWithPattern -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.unregisterNonExistent -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.rejectDuplicateId -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.clearAllHooks -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.getByEvent -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest$HookRegistrationTests.unregisterById -- Time elapsed: 0.002 s
[INFO] Tests run: 0, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.049 s -- in org.springaicommunity.claude.agent.sdk.hooks.HookRegistryTest
[INFO] Running org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest
[INFO] Running org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$ServerInfoTests
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s -- in org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$ServerInfoTests
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$ServerInfoTests.shouldReturnEmptyServerInfoWhenNotConnected -- Time elapsed: 0.003 s
[INFO] Running org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$CloseTests
11:10:07.629 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:10:07.630 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 s -- in org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$CloseTests
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$CloseTests.disconnectShouldAliasClose -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$CloseTests.shouldBeIdempotentOnClose -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$HookRegistrationTests
11:10:07.634 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash
11:10:07.634 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_1, event=POST_TOOL_USE, pattern=Edit
11:10:07.636 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=POST_TOOL_USE, pattern=null
11:10:07.638 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 s -- in org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$HookRegistrationTests
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$HookRegistrationTests.shouldSupportFluentRegistration -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$HookRegistrationTests.shouldRegisterHookForAllTools -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$HookRegistrationTests.shouldRegisterHook -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$SessionStateTests
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 s -- in org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$SessionStateTests
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$SessionStateTests.shouldThrowWhenInterruptingWithoutConnection -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$SessionStateTests.shouldThrowWhenSettingModelWithoutConnection -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$SessionStateTests.shouldThrowWhenSettingPermissionModeWithoutConnection -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$SessionStateTests.shouldNotBeConnectedAfterCreation -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$SessionStateTests.shouldThrowWhenQueryingWithoutConnection -- Time elapsed: 0.002 s
[INFO] Running org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$BuilderTests
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s -- in org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$BuilderTests
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$BuilderTests.shouldBuildWithAllParams -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$BuilderTests.shouldBuildWithRequiredParams -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest$BuilderTests.shouldThrowWhenWorkingDirNull -- Time elapsed: 0 s
[INFO] Tests run: 0, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.034 s -- in org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSessionTest
[INFO] Running org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscoveryTest
11:10:07.656 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/nonexistent/claude, --version].
11:10:07.658 [main] DEBUG org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscovery -- Claude CLI not found at: /nonexistent/claude (Could not execute [/nonexistent/claude, --version]. Error=2, No such file or directory)
[WARNING] Tests run: 4, Failures: 0, Errors: 0, Skipped: 2, Time elapsed: 0.006 s -- in org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscoveryTest
[WARNING] org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscoveryTest.testDiscoverClaudePathWhenNotAvailable -- Time elapsed: 0.003 s
[WARNING] org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscoveryTest skipped
[WARNING] org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscoveryTest skipped
[WARNING] org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscoveryTest.testGetDiscoveredPathWhenNotAvailable -- Time elapsed: 0 s
[INFO] Running org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest
[INFO] Running org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BackpressureTests
11:10:07.678 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.679 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.016 s -- in org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BackpressureTests
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BackpressureTests.respectQueueCapacity -- Time elapsed: 0.016 s
[INFO] Running org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ThreadSafetyTests
11:10:07.688 [pool-3-thread-1] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.688 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.712 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.031 s -- in org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ThreadSafetyTests
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ThreadSafetyTests.concurrentOfferAndConsume -- Time elapsed: 0.007 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ThreadSafetyTests.handleInterrupt -- Time elapsed: 0.023 s
[INFO] Running org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$StateQueryTests
11:10:07.714 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.714 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.714 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.715 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.715 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 s -- in org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$StateQueryTests
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$StateQueryTests.bufferedCount -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$StateQueryTests.isActiveAfterClose -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$StateQueryTests.isActiveInitially -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$StateQueryTests.isActiveAfterComplete -- Time elapsed: 0 s
[INFO] Running org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ClosingTests
11:10:07.717 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.719 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.719 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 s -- in org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ClosingTests
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ClosingTests.rejectAfterClose -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ClosingTests.closeIsIdempotent -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$ClosingTests.stopOnClose -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$CompletionHandlingTests
11:10:07.721 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.721 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.722 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.722 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.723 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.723 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.724 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed with error: Test error
11:10:07.724 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.005 s -- in org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$CompletionHandlingTests
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$CompletionHandlingTests.signalCompletion -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$CompletionHandlingTests.rejectAfterCompletion -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$CompletionHandlingTests.completeIsIdempotent -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$CompletionHandlingTests.propagateError -- Time elapsed: 0.002 s
[INFO] Running org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BasicIterationTests
11:10:07.727 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.727 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.729 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.730 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.731 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.732 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.732 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.732 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:10:07.733 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:10:07.733 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 s -- in org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BasicIterationTests
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BasicIterationTests.iterateOverMessages -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BasicIterationTests.singleMessage -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BasicIterationTests.forEachLoop -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BasicIterationTests.hasNextReturnsFalseWhenEmpty -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest$BasicIterationTests.throwsWhenNoMoreElements -- Time elapsed: 0 s
[INFO] Tests run: 0, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.071 s -- in org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIteratorTest
[INFO] Running org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest
[INFO] Running org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ProtocolCompatibility
11:10:07.746 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=hook_callback, requestId=req_1
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.014 s -- in org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ProtocolCompatibility
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ProtocolCompatibility.bidirectionalFlow -- Time elapsed: 0.014 s
[INFO] Running org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$BackwardsCompatibility
11:10:07.752 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=interrupt, requestId=req_1
11:10:07.755 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=interrupt, requestId=req_1
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 s -- in org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$BackwardsCompatibility
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$BackwardsCompatibility.extraWhitespace -- Time elapsed: 0.003 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$BackwardsCompatibility.unknownFieldsIgnored -- Time elapsed: 0.004 s
[INFO] Running org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ErrorHandling
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 s -- in org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ErrorHandling
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ErrorHandling.missingTypeField -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ErrorHandling.controlRequestMissingRequestId -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ErrorHandling.blankInput -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ErrorHandling.nullInput -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ErrorHandling.malformedJson -- Time elapsed: 0.001 s
[INFO] Running org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$HelperMethods
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s -- in org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$HelperMethods
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$HelperMethods.extractRequestIdSuccess -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$HelperMethods.isControlRequestFalse -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$HelperMethods.isControlRequestInvalidJson -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$HelperMethods.extractRequestIdFromRegularMessage -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$HelperMethods.isControlRequestTrue -- Time elapsed: 0 s
[INFO] Running org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ParsedMessageApi
11:10:07.768 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=interrupt, requestId=req_1
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s -- in org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ParsedMessageApi
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ParsedMessageApi.controlRequestAccessors -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ParsedMessageApi.regularMessageAccessors -- Time elapsed: 0 s
[INFO] Running org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$RegularMessageParsing
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.003 s -- in org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$RegularMessageParsing
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$RegularMessageParsing.parseResultMessage -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$RegularMessageParsing.parseAssistantMessage -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$RegularMessageParsing.parseAssistantMessageWithToolUse -- Time elapsed: 0 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$RegularMessageParsing.parseUserMessage -- Time elapsed: 0.001 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$RegularMessageParsing.parseSystemMessage -- Time elapsed: 0 s
[INFO] Running org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ControlRequestParsing
11:10:07.776 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=hook_callback, requestId=req_3_ghi789
11:10:07.780 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=can_use_tool, requestId=req_2_def456
11:10:07.783 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=mcp_message, requestId=req_mcp_001
11:10:07.787 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=set_permission_mode, requestId=req_perm_001
11:10:07.790 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=initialize, requestId=req_1_init
11:10:07.792 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=interrupt, requestId=req_int_001
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.018 s -- in org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ControlRequestParsing
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ControlRequestParsing.parseHookCallbackRequest -- Time elapsed: 0.002 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ControlRequestParsing.parseCanUseToolRequest -- Time elapsed: 0.004 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ControlRequestParsing.parseMcpMessageRequest -- Time elapsed: 0.004 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ControlRequestParsing.parseSetPermissionModeRequest -- Time elapsed: 0.003 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ControlRequestParsing.parseInitializeRequest -- Time elapsed: 0.003 s
[INFO] org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest$ControlRequestParsing.parseInterruptRequest -- Time elapsed: 0.002 s
[INFO] Tests run: 0, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.058 s -- in org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParserTest
[INFO] 
[INFO] Results:
[INFO] 
[WARNING] Tests run: 159, Failures: 0, Errors: 0, Skipped: 2
[INFO] 
[INFO] 
[INFO] --- jacoco:0.8.11:report (report) @ claude-code-sdk ---
[INFO] Skipping JaCoCo execution due to missing execution data file.
[INFO] 
[INFO] --- jar:3.3.0:jar (default-jar) @ claude-code-sdk ---
[INFO] Building jar: /home/mark/community/claude-agent-sdk-java/claude-code-sdk/target/claude-code-sdk-1.0.0-SNAPSHOT.jar
[INFO] 
[INFO] >>> source:3.3.0:jar (generate-sources) > generate-sources @ claude-code-sdk >>>
[INFO] 
[INFO] --- jacoco:0.8.11:prepare-agent (prepare-agent) @ claude-code-sdk ---
[INFO] argLine set to -javaagent:/home/mark/.m2/repository/org/jacoco/org.jacoco.agent/0.8.11/org.jacoco.agent-0.8.11-runtime.jar=destfile=/home/mark/community/claude-agent-sdk-java/claude-code-sdk/target/jacoco.exec
[INFO] 
[INFO] <<< source:3.3.0:jar (generate-sources) < generate-sources @ claude-code-sdk <<<
[INFO] 
[INFO] 
[INFO] --- source:3.3.0:jar (generate-sources) @ claude-code-sdk ---
[INFO] Building jar: /home/mark/community/claude-agent-sdk-java/claude-code-sdk/target/claude-code-sdk-1.0.0-SNAPSHOT-sources.jar
[INFO] 
[INFO] --- jacoco:0.8.11:prepare-agent-integration (prepare-agent-integration) @ claude-code-sdk ---
[INFO] argLine set to -javaagent:/home/mark/.m2/repository/org/jacoco/org.jacoco.agent/0.8.11/org.jacoco.agent-0.8.11-runtime.jar=destfile=/home/mark/community/claude-agent-sdk-java/claude-code-sdk/target/jacoco-it.exec
[INFO] 
[INFO] --- failsafe:3.5.2:integration-test (default) @ claude-code-sdk ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.StdioTransportIntegrationIT
11:10:08.561 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [claude, --version].
11:10:08.571 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=8437, exitValue="not exited"]
11:10:08.807 [WaitForProcess-Process[pid=8437, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=8437, exitValue=0] stopped with exit code 0
11:10:08.809 [main] DEBUG org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscovery -- Found Claude CLI at claude with version: 2.0.65 (Claude Code)
11:10:08.809 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [which, claude].
11:10:08.810 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=8453, exitValue="not exited"]
11:10:08.811 [WaitForProcess-Process[pid=8453, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=8453, exitValue=0] stopped with exit code 0
11:10:08.811 [main] DEBUG org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscovery -- Resolved command 'claude' to full path: /home/mark/.local/bin/claude
11:10:08.811 [main] INFO org.springaicommunity.claude.agent.sdk.config.ClaudeCliDiscovery -- Claude CLI found at: /home/mark/.local/bin/claude
11:10:08.811 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:10:08.878 [main] DEBUG reactor.util.Loggers -- Using Slf4j logging framework
11:10:08.924 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:10:08.924 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:10:08.930 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:10:08.938 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Hi"}}
11:10:16.822 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:10:16.827 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:16.868 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:10:16.869 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:10:16.871 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:10:16.872 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Remember: my favorite color is blue."}}
11:10:43.129 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is my favorite color?"}}
11:10:43.129 [claude-outbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Dropping message - transport closing or closed
11:10:45.319 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:45.319 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:10:45.322 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:10:45.323 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:10:45.325 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:10:45.326 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hello"}}
11:10:52.902 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:10:52.902 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:52.907 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:52.910 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:10:52.910 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:10:52.913 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:10:52.915 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say 'test'"}}
11:10:56.060 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:10:56.060 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:10:56.064 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:10:56.065 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:10:56.067 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:10:56.068 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 1+1?"}}
11:11:20.403 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:11:20.403 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:11:20.407 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:11:20.407 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, default]
11:11:20.409 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:11:20.410 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is the capital of France?"}}
11:11:56.052 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:11:56.356 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:11:56.370 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:11:56.370 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:11:56.372 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:11:56.373 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 2 + 2? Reply with just the number."}}
11:11:59.976 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:11:59.977 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:11:59.980 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:11:59.980 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:11:59.982 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:11:59.983 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hi"}}
11:12:03.132 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:12:03.132 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[ERROR] Tests run: 9, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 114.6 s <<< FAILURE! -- in org.springaicommunity.claude.agent.sdk.transport.StdioTransportIntegrationIT
[ERROR] org.springaicommunity.claude.agent.sdk.transport.StdioTransportIntegrationIT.transportShouldHandleConcurrentMessageHandlers -- Time elapsed: 35.96 s <<< FAILURE!
org.opentest4j.AssertionFailedError: 

Expecting value to be true but was false
	at java.base/jdk.internal.reflect.DirectConstructorHandleAccessor.newInstance(DirectConstructorHandleAccessor.java:62)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:502)
	at org.springaicommunity.claude.agent.sdk.transport.StdioTransportIntegrationIT.lambda$transportShouldHandleConcurrentMessageHandlers$18(StdioTransportIntegrationIT.java:312)
	at org.springaicommunity.claude.agent.sdk.transport.StdioTransportIntegrationIT.withTransport(StdioTransportIntegrationIT.java:71)
	at org.springaicommunity.claude.agent.sdk.transport.StdioTransportIntegrationIT.transportShouldHandleConcurrentMessageHandlers(StdioTransportIntegrationIT.java:297)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)

[INFO] Running org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT
11:12:03.139 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:12:03.182 [main] DEBUG org.springaicommunity.claude.agent.sdk.resilience.ResilienceManager -- Starting resilient flux operation 'reactive-query'
11:12:03.188 [boundedElastic-1] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- Starting reactive query with BidirectionalTransport
11:12:03.191 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:12:03.192 [boundedElastic-1] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --permission-mode, bypassPermissions]
11:12:03.194 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:12:03.195 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 7+7?"}}
11:12:04.175 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Received message: SystemMessage
11:12:06.748 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Consuming message: AssistantMessage
11:12:06.765 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Consuming message: ResultMessage
11:12:06.766 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.resilience.ResilienceManager -- Flux operation 'reactive-query' completed
11:12:06.767 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- Closing ephemeral transport on disposal
11:12:06.768 [main] DEBUG org.springaicommunity.claude.agent.sdk.resilience.ResilienceManager -- Starting resilient flux operation 'reactive-query'
11:12:06.769 [boundedElastic-1] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- Starting reactive query with BidirectionalTransport
11:12:06.769 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:12:06.769 [boundedElastic-1] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --permission-mode, bypassPermissions]
11:12:06.771 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:12:06.772 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 9+9?"}}
11:12:07.127 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:12:07.128 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:12:07.549 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Received message: SystemMessage
11:12:10.746 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Consuming message: AssistantMessage
11:12:10.786 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Consuming message: ResultMessage
11:12:10.786 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.resilience.ResilienceManager -- Flux operation 'reactive-query' completed
11:12:10.786 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- Closing ephemeral transport on disposal
11:12:10.788 [main] DEBUG org.springaicommunity.claude.agent.sdk.resilience.ResilienceManager -- Starting resilient flux operation 'reactive-query'
11:12:10.788 [boundedElastic-1] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- Starting reactive query with BidirectionalTransport
11:12:10.789 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:12:10.789 [boundedElastic-1] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --permission-mode, bypassPermissions]
11:12:10.791 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:12:10.791 [boundedElastic-1] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 5+5?"}}
11:12:11.555 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Received message: SystemMessage
11:12:11.660 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:12:11.660 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:12:15.329 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Received message: AssistantMessage
11:12:15.351 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT -- Consuming message: ResultMessage
11:12:15.352 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.resilience.ResilienceManager -- Flux operation 'reactive-query' completed
11:12:15.352 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- Closing ephemeral transport on disposal
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 12.22 s -- in org.springaicommunity.claude.agent.sdk.transport.ReactiveOutputFormatIT
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT
11:12:15.354 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:12:15.356 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- Using Claude CLI at: /home/mark/.local/bin/claude
11:12:15.356 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Calculate the square root of 144]
11:12:15.357 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:12:15.357 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Calculate the square root of 144] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:12:15.359 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=9876, exitValue="not exited"]
11:12:25.381 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:12:25.381 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:12:29.693 [WaitForProcess-Process[pid=9876, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=9876, exitValue=0] stopped with exit code 0
11:12:29.695 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:12:29.700 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- Complex query usage: {server_tool_use={web_fetch_requests=0, web_search_requests=0}, output_tokens=29, service_tier=standard, cache_creation={ephemeral_1h_input_tokens=0, ephemeral_5m_input_tokens=327}, cache_creation_input_tokens=327, input_tokens=3, cache_read_input_tokens=17728}
11:12:29.701 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- Complex query result: The square root of 144 is **12**.

This is because 12  12 = 144.
11:12:29.702 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- Using Claude CLI at: /home/mark/.local/bin/claude
11:12:29.703 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, What is 2+2? Give a brief answer.]
11:12:29.703 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:12:29.703 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, What is 2+2? Give a brief answer.] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:12:29.705 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=10005, exitValue="not exited"]
11:12:36.595 [WaitForProcess-Process[pid=10005, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=10005, exitValue=0] stopped with exit code 0
11:12:36.596 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:12:36.597 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- JSON format - Usage: {server_tool_use={web_fetch_requests=0, web_search_requests=0}, output_tokens=13, service_tier=standard, cache_creation={ephemeral_1h_input_tokens=0, ephemeral_5m_input_tokens=332}, cache_creation_input_tokens=332, input_tokens=3, cache_read_input_tokens=17728}
11:12:36.597 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- JSON format - Total cost: $0.012874
11:12:36.598 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- JSON format result: 2 + 2 = 4
11:12:36.599 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- Using Claude CLI at: /home/mark/.local/bin/claude
11:12:36.600 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, stream-json, --verbose, --permission-mode, bypassPermissions, --, What is 3+3? Give a brief answer.]
11:12:36.600 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:12:36.600 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, stream-json, --verbose, --permission-mode, bypassPermissions, --, What is 3+3? Give a brief answer.] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:12:36.602 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=10132, exitValue="not exited"]
11:12:42.207 [WaitForProcess-Process[pid=10132, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=10132, exitValue=0] stopped with exit code 0
11:12:42.208 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 3 messages
11:12:42.211 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- STREAM_JSON format - Got 3 messages
11:12:42.211 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- STREAM_JSON format result: 3 + 3 = 6
11:12:42.213 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- Using Claude CLI at: /home/mark/.local/bin/claude
11:12:42.213 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, text, --permission-mode, bypassPermissions, --, What is 4+4? Give a brief answer.]
11:12:42.213 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:12:42.214 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, text, --permission-mode, bypassPermissions, --, What is 4+4? Give a brief answer.] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:12:42.215 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=10252, exitValue="not exited"]
11:12:46.722 [WaitForProcess-Process[pid=10252, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=10252, exitValue=0] stopped with exit code 0
11:12:46.722 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 1 messages
11:12:46.722 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- TEXT format result: 4 + 4 = 8
11:12:46.724 [main] INFO org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT -- Using Claude CLI at: /home/mark/.local/bin/claude
11:12:46.725 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --dangerously-skip-permissions, --, Hello]
11:12:46.725 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:12:46.725 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --dangerously-skip-permissions, --, Hello] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:12:46.726 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=10374, exitValue="not exited"]
11:12:51.657 [WaitForProcess-Process[pid=10374, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=10374, exitValue=0] stopped with exit code 0
11:12:51.658 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 36.31 s -- in org.springaicommunity.claude.agent.sdk.transport.OutputFormatIT
[INFO] Running org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportIT
11:12:51.662 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:12:51.665 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:12:51.665 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:12:51.668 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:12:51.668 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hello"}}
11:12:56.073 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:12:56.073 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:12:56.076 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:12:56.077 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:12:56.079 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:12:56.080 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Count from 1 to 1000, saying each number on a new line"}}
11:12:58.081 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTED -> CLOSING
11:12:58.102 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:12:59.082 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:12:59.085 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:12:59.086 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:12:59.089 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:12:59.089 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 2+2? Reply with just the number."}}
11:13:01.725 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:13:01.726 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:13:01.728 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:13:01.728 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:13:01.731 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:13:01.731 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hello"}}
11:13:04.057 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:13:04.057 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:13:04.060 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:13:04.060 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:13:04.063 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:13:04.063 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is the capital of France? Just say the city name."}}
11:13:07.645 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:13:07.645 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 15.98 s -- in org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransportIT
[INFO] Running org.springaicommunity.claude.agent.sdk.ClaudeCliPrototypeIT
11:13:07.648 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:13:07.650 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Testing streaming output with prompt: What is 1+1?
11:13:07.650 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --output-format, stream-json, --verbose, --print, What is 1+1?] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:13:07.651 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=11081, exitValue="not exited"]
11:13:09.237 [Thread-13] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Received line: {"type":"system","subtype":"init","cwd":"/home/mark/community/claude-agent-sdk-java/claude-code-sdk","session_id":"3fcb8e99-9313-4e60-a99d-4b1ee264fcfa","tools":["Task","TaskOutput","Bash","Glob","Grep","ExitPlanMode","Read","Edit","Write","NotebookEdit","WebFetch","TodoWrite","WebSearch","KillShell","Skill","SlashCommand","EnterPlanMode"],"mcp_servers":[],"model":"claude-opus-4-5-20251101","permissionMode":"default","slash_commands":["compact","context","cost","init","pr-comments","release-notes","review","security-review"],"apiKeySource":"none","claude_code_version":"2.0.65","output_style":"default","agents":["general-purpose","statusline-setup","Explore","Plan","claude-code-guide"],"skills":[],"plugins":[],"uuid":"b605e86a-951d-4263-bc20-920124fb8be6"}
11:13:11.898 [Thread-13] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Received line: {"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01URfSK5ZiTv3KSeR1NWne4K","type":"message","role":"assistant","content":[{"type":"text","text":"2"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":327,"cache_read_input_tokens":17728,"cache_creation":{"ephemeral_5m_input_tokens":327,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"3fcb8e99-9313-4e60-a99d-4b1ee264fcfa","uuid":"a94a6733-cff5-432e-ba04-62444bc0c318"}
11:13:11.947 [Thread-13] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Received line: {"type":"result","subtype":"success","is_error":false,"duration_ms":2718,"duration_api_ms":4309,"num_turns":1,"result":"2","session_id":"3fcb8e99-9313-4e60-a99d-4b1ee264fcfa","total_cost_usd":0.01250775,"usage":{"input_tokens":3,"cache_creation_input_tokens":327,"cache_read_input_tokens":17728,"output_tokens":5,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":327}},"modelUsage":{"claude-haiku-4-5-20251001":{"inputTokens":915,"outputTokens":109,"cacheReadInputTokens":0,"cacheCreationInputTokens":0,"webSearchRequests":0,"costUSD":0.00146,"contextWindow":200000},"claude-opus-4-5-20251101":{"inputTokens":3,"outputTokens":5,"cacheReadInputTokens":17728,"cacheCreationInputTokens":327,"webSearchRequests":0,"costUSD":0.01104775,"contextWindow":200000}},"permission_denials":[],"uuid":"a48a2b77-afaf-4c64-afb1-fef25972ebb5"}
11:13:12.344 [WaitForProcess-Process[pid=11081, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=11081, exitValue=0] stopped with exit code 0
11:13:12.344 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Streaming completed with exit code: 0
11:13:12.346 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Testing basic Claude CLI execution
11:13:12.346 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk.
11:13:12.347 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=11198, exitValue="not exited"]
11:13:12.767 [WaitForProcess-Process[pid=11198, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=11198, exitValue=0] stopped with exit code 0
11:13:12.767 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Claude CLI version: 2.0.65 (Claude Code)
11:13:12.767 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Exit code: 0
11:13:12.769 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Testing real-time streaming
11:13:12.769 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --output-format, stream-json, --verbose, --print, Hello, world!] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:13:12.771 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=11213, exitValue="not exited"]
11:13:14.119 [Thread-17] DEBUG org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Processing line: {"type":"system","subtype":"init","cwd":"/home/mark/community/claude-agent-sdk-java/claude-code-sdk","session_id":"955e3f8d-3ab6-4a58-8014-ea4e7d193ead","tools":["Task","TaskOutput","Bash","Glob","Grep","ExitPlanMode","Read","Edit","Write","NotebookEdit","WebFetch","TodoWrite","WebSearch","KillShell","Skill","SlashCommand","EnterPlanMode"],"mcp_servers":[],"model":"claude-opus-4-5-20251101","permissionMode":"default","slash_commands":["compact","context","cost","init","pr-comments","release-notes","review","security-review"],"apiKeySource":"none","claude_code_version":"2.0.65","output_style":"default","agents":["general-purpose","statusline-setup","Explore","Plan","claude-code-guide"],"skills":[],"plugins":[],"uuid":"77d9faf8-075e-4228-8192-0ba02e0c73d6"}
11:13:14.119 [Thread-17] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Complete JSON message: {"type":"system","subtype":"init","cwd":"/home/mark/community/claude-agent-sdk-java/claude-code-sdk","session_id":"955e3f8d-3ab6-4a58-8014-ea4e7d193ead","tools":["Task","TaskOutput","Bash","Glob","Grep","ExitPlanMode","Read","Edit","Write","NotebookEdit","WebFetch","TodoWrite","WebSearch","KillShell","Skill","SlashCommand","EnterPlanMode"],"mcp_servers":[],"model":"claude-opus-4-5-20251101","permissionMode":"default","slash_commands":["compact","context","cost","init","pr-comments","release-notes","review","security-review"],"apiKeySource":"none","claude_code_version":"2.0.65","output_style":"default","agents":["general-purpose","statusline-setup","Explore","Plan","claude-code-guide"],"skills":[],"plugins":[],"uuid":"77d9faf8-075e-4228-8192-0ba02e0c73d6"}
11:13:18.586 [Thread-17] DEBUG org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Processing line: {"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Uwdr45XwEfVEQd2K7J8GGo","type":"message","role":"assistant","content":[{"type":"text","text":"Hello! How can I help you today with your Java project?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":324,"cache_read_input_tokens":17728,"cache_creation":{"ephemeral_5m_input_tokens":324,"ephemeral_1h_input_tokens":0},"output_tokens":16,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"955e3f8d-3ab6-4a58-8014-ea4e7d193ead","uuid":"1197fd7f-1b26-4b5e-9cf4-81eb9dc3c644"}
11:13:18.587 [Thread-17] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Complete JSON message: {"type":"assistant","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Uwdr45XwEfVEQd2K7J8GGo","type":"message","role":"assistant","content":[{"type":"text","text":"Hello! How can I help you today with your Java project?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":324,"cache_read_input_tokens":17728,"cache_creation":{"ephemeral_5m_input_tokens":324,"ephemeral_1h_input_tokens":0},"output_tokens":16,"service_tier":"standard"},"context_management":null},"parent_tool_use_id":null,"session_id":"955e3f8d-3ab6-4a58-8014-ea4e7d193ead","uuid":"1197fd7f-1b26-4b5e-9cf4-81eb9dc3c644"}
11:13:18.590 [Thread-17] DEBUG org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Processing line: {"type":"result","subtype":"success","is_error":false,"duration_ms":4480,"duration_api_ms":7572,"num_turns":1,"result":"Hello! How can I help you today with your Java project?","session_id":"955e3f8d-3ab6-4a58-8014-ea4e7d193ead","total_cost_usd":0.012789000000000002,"usage":{"input_tokens":3,"cache_creation_input_tokens":324,"cache_read_input_tokens":17728,"output_tokens":16,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":324}},"modelUsage":{"claude-haiku-4-5-20251001":{"inputTokens":915,"outputTokens":114,"cacheReadInputTokens":0,"cacheCreationInputTokens":0,"webSearchRequests":0,"costUSD":0.001485,"contextWindow":200000},"claude-opus-4-5-20251101":{"inputTokens":3,"outputTokens":16,"cacheReadInputTokens":17728,"cacheCreationInputTokens":324,"webSearchRequests":0,"costUSD":0.011304000000000002,"contextWindow":200000}},"permission_denials":[],"uuid":"63703b27-4312-40d8-a92e-4929bfc1ffc9"}
11:13:18.590 [Thread-17] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Complete JSON message: {"type":"result","subtype":"success","is_error":false,"duration_ms":4480,"duration_api_ms":7572,"num_turns":1,"result":"Hello! How can I help you today with your Java project?","session_id":"955e3f8d-3ab6-4a58-8014-ea4e7d193ead","total_cost_usd":0.012789000000000002,"usage":{"input_tokens":3,"cache_creation_input_tokens":324,"cache_read_input_tokens":17728,"output_tokens":16,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":0,"ephemeral_5m_input_tokens":324}},"modelUsage":{"claude-haiku-4-5-20251001":{"inputTokens":915,"outputTokens":114,"cacheReadInputTokens":0,"cacheCreationInputTokens":0,"webSearchRequests":0,"costUSD":0.001485,"contextWindow":200000},"claude-opus-4-5-20251101":{"inputTokens":3,"outputTokens":16,"cacheReadInputTokens":17728,"cacheCreationInputTokens":324,"webSearchRequests":0,"costUSD":0.011304000000000002,"contextWindow":200000}},"permission_denials":[],"uuid":"63703b27-4312-40d8-a92e-4929bfc1ffc9"}
11:13:22.646 [WaitForProcess-Process[pid=11213, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=11213, exitValue=0] stopped with exit code 0
11:13:22.647 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeCliPrototype -- Real-time streaming completed with exit code: 0
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 15.00 s -- in org.springaicommunity.claude.agent.sdk.ClaudeCliPrototypeIT
[INFO] Running org.springaicommunity.claude.agent.sdk.mcp.McpIntegrationIT
11:13:22.650 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:13:22.666 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:13:22.704 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions, --mcp-config, {"mcpServers":{"fs":{"type":"stdio","command":"npx","args":["-y","@modelcontextprotocol/server-filesystem","/tmp"],"env":{}}}}]
11:13:22.706 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:13:22.707 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 2+2? Answer with just the number."}}
11:13:30.962 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:13:30.962 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:13:30.968 [main] WARN org.springaicommunity.claude.agent.sdk.mcp.McpMessageHandler -- Unknown MCP server: unknown-server
[INFO] Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 8.320 s -- in org.springaicommunity.claude.agent.sdk.mcp.McpIntegrationIT
[INFO] Running org.springaicommunity.claude.agent.sdk.permission.PermissionIntegrationIT
11:13:30.971 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:13:30.973 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:13:30.973 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, default]
11:13:30.976 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:13:30.977 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Create a file /tmp/bash_test.txt containing 'hello'"}}
11:13:33.858 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=can_use_tool, requestId=c3ec2f98-f779-4ae5-a02f-e40747f150a7
11:13:33.859 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=can_use_tool, requestId=c3ec2f98-f779-4ae5-a02f-e40747f150a7
Permission callback for: Write
11:13:33.865 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"c3ec2f98-f779-4ae5-a02f-e40747f150a7","response":{"behavior":"allow"}}}
11:13:35.705 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=can_use_tool, requestId=3df0a4b4-e0d5-4fd7-8bee-19a5c46860be
11:13:35.705 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=can_use_tool, requestId=3df0a4b4-e0d5-4fd7-8bee-19a5c46860be
Permission callback for: Bash
11:13:35.706 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"3df0a4b4-e0d5-4fd7-8bee-19a5c46860be","response":{"behavior":"allow"}}}
Callback invocations: [Write, Bash]
11:13:38.643 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:13:38.644 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:13:38.647 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:13:38.647 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, default]
11:13:38.649 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:13:38.650 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Write 'hello world' to /tmp/test.txt"}}
Got message: RegularMessage[message=SystemMessage[subtype=init, data={mcp_servers=[], plugins=[], apiKeySource=none, session_id=9c2d43a8-dbe5-499a-ab74-4250ebce4f0e, tools=[Task, TaskOutput, Bash, Glob, Grep, ExitPlanMode, Read, Edit, Write, NotebookEdit, WebFetch, TodoWrite, WebSearch, KillShell, Skill, SlashCommand, EnterPlanMode], uuid=9adaf152-adf4-43e5-bee5-e29fb755c2cd, slash_commands=[compact, context, cost, init, pr-comments, release-notes, review, security-review], agents=[general-purpose, statusline-setup, Explore, Plan, claude-code-guide], skills=[], cwd=/home/mark/community/claude-agent-sdk-java/claude-code-sdk, permissionMode=default, model=claude-haiku-4-5-20251001, claude_code_version=2.0.65, output_style=default}]]
Got message: RegularMessage[message=AssistantMessage[content=[TextBlock[text=I'll write 'hello world' to /tmp/test.txt for you.]]]]
Got message: RegularMessage[message=AssistantMessage[content=[ToolUseBlock[id=toolu_01TjHUtEoDAs8N35er1iMUuR, name=Write, input={file_path=/tmp/test.txt, content=hello world}]]]]
11:13:41.788 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=can_use_tool, requestId=e363a4df-c8ff-4a9a-9039-0a2c44cdf19e
11:13:41.788 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=can_use_tool, requestId=e363a4df-c8ff-4a9a-9039-0a2c44cdf19e
Permission callback called for: Write, input: {file_path=/tmp/test.txt, content=hello world}
11:13:41.791 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"e363a4df-c8ff-4a9a-9039-0a2c44cdf19e","response":{"behavior":"allow"}}}
Got message: RegularMessage[message=UserMessage[content=[ToolResultBlock[toolUseId=toolu_01TjHUtEoDAs8N35er1iMUuR, content=Tool permission request failed: [
  {
    "code": "invalid_union",
    "unionErrors": [
      {
        "issues": [
          {
            "code": "invalid_type",
            "expected": "object",
            "received": "undefined",
            "path": [
              "updatedInput"
            ],
            "message": "Required"
          }
        ],
        "name": "ZodError"
      },
      {
        "issues": [
          {
            "received": "allow",
            "code": "invalid_literal",
            "expected": "deny",
            "path": [
              "behavior"
            ],
            "message": "Invalid literal value, expected \"deny\""
          },
          {
            "code": "invalid_type",
            "expected": "string",
            "received": "undefined",
            "path": [
              "message"
            ],
            "message": "Required"
          }
        ],
        "name": "ZodError"
      }
    ],
    "path": [],
    "message": "Invalid input"
  }
], isError=true]]]]
Got message: RegularMessage[message=AssistantMessage[content=[TextBlock[text=It looks like there was a permission or configuration issue with the Write tool. Let me use Bash to write the file instead.]]]]
Got message: RegularMessage[message=AssistantMessage[content=[ToolUseBlock[id=toolu_01KEehfyNVAGwFr4fmqv1Eqn, name=Bash, input={description=Write hello world to /tmp/test.txt, command=echo 'hello world' > /tmp/test.txt}]]]]
11:13:44.999 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=can_use_tool, requestId=c5e0f8fe-3c47-4887-bc5c-af90c798a70b
11:13:44.999 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=can_use_tool, requestId=c5e0f8fe-3c47-4887-bc5c-af90c798a70b
Permission callback called for: Bash, input: {command=echo 'hello world' > /tmp/test.txt, description=Write hello world to /tmp/test.txt}
11:13:44.999 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"c5e0f8fe-3c47-4887-bc5c-af90c798a70b","response":{"behavior":"allow"}}}
Got message: RegularMessage[message=UserMessage[content=[ToolResultBlock[toolUseId=toolu_01KEehfyNVAGwFr4fmqv1Eqn, content=Tool permission request failed: [
  {
    "code": "invalid_union",
    "unionErrors": [
      {
        "issues": [
          {
            "code": "invalid_type",
            "expected": "object",
            "received": "undefined",
            "path": [
              "updatedInput"
            ],
            "message": "Required"
          }
        ],
        "name": "ZodError"
      },
      {
        "issues": [
          {
            "received": "allow",
            "code": "invalid_literal",
            "expected": "deny",
            "path": [
              "behavior"
            ],
            "message": "Invalid literal value, expected \"deny\""
          },
          {
            "code": "invalid_type",
            "expected": "string",
            "received": "undefined",
            "path": [
              "message"
            ],
            "message": "Required"
          }
        ],
        "name": "ZodError"
      }
    ],
    "path": [],
    "message": "Invalid input"
  }
], isError=true]]]]
Got message: RegularMessage[message=AssistantMessage[content=[TextBlock[text=I'm unable to write to /tmp/test.txt due to permission restrictions in your environment configuration. This appears to be a security policy issue with your Claude Code setup. 

If you'd like to enable file writing, you may need to check your Claude Code configuration or hooks. You can also try running this command directly in your terminal:

```bash
echo 'hello world' > /tmp/test.txt
```]]]]
Got message: RegularMessage[message=ResultMessage[subtype=success, durationMs=7958, durationApiMs=10232, isError=false, numTurns=3, sessionId=9c2d43a8-dbe5-499a-ab74-4250ebce4f0e, totalCostUsd=0.009994250000000001, usage={server_tool_use={web_fetch_requests=0.0, web_search_requests=0.0}, output_tokens=304.0, service_tier=standard, cache_creation={ephemeral_1h_input_tokens=0.0, ephemeral_5m_input_tokens=1121.0}, cache_creation_input_tokens=1121.0, input_tokens=17.0, cache_read_input_tokens=54210.0}, result=I'm unable to write to /tmp/test.txt due to permission restrictions in your environment configuration. This appears to be a security policy issue with your Claude Code setup. 

If you'd like to enable file writing, you may need to check your Claude Code configuration or hooks. You can also try running this command directly in your terminal:

```bash
echo 'hello world' > /tmp/test.txt
```, structuredOutput=null]]
Callback invocations: [Write, Bash]
11:13:48.149 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:13:48.149 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:13:48.152 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:13:48.152 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-sonnet-4-5-20250929, --permission-mode, default]
11:13:48.155 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:13:48.156 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Use the Write tool to create a file at /tmp/denied.txt with content 'test'. Do not ask me questions, just use the Write tool immediately."}}
11:13:54.711 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=can_use_tool, requestId=20903c0d-5319-43d4-8e6f-acff82a71f83
11:13:54.712 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=can_use_tool, requestId=20903c0d-5319-43d4-8e6f-acff82a71f83
Denying tool: Write
11:13:54.713 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"20903c0d-5319-43d4-8e6f-acff82a71f83","response":{"behavior":"deny"}}}
Denied tools: [Write]
11:14:12.760 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:14:12.761 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:14:12.763 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:14:12.763 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:14:12.765 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:14:12.766 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 2 + 2?"}}
Callback invocations in bypass mode: []
11:14:15.551 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:14:15.551 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:14:15.554 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:14:15.554 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, default]
11:14:15.556 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:14:15.557 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Read the file /etc/hostname"}}
11:14:18.040 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=can_use_tool, requestId=da21cb95-fa24-49e1-b8a8-4e4f37d530e6
11:14:18.040 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=can_use_tool, requestId=da21cb95-fa24-49e1-b8a8-4e4f37d530e6
Captured tool: Read
Captured input: {file_path=/etc/hostname}
11:14:18.042 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"da21cb95-fa24-49e1-b8a8-4e4f37d530e6","response":{"behavior":"allow"}}}
11:14:19.410 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=can_use_tool, requestId=8b7b1510-7146-46e9-ba45-6fa0ff196d3b
11:14:19.410 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=can_use_tool, requestId=8b7b1510-7146-46e9-ba45-6fa0ff196d3b
Captured tool: Bash
Captured input: {command=cat /etc/hostname, description=Read hostname file}
11:14:19.410 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"8b7b1510-7146-46e9-ba45-6fa0ff196d3b","response":{"behavior":"allow"}}}
11:14:23.166 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:14:23.167 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 52.20 s -- in org.springaicommunity.claude.agent.sdk.permission.PermissionIntegrationIT
[INFO] Running org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT
11:14:23.170 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:14:23.170 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Testing edge cases with various response types
11:14:23.171 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 23
11:14:23.172 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:23.173 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12143, exitValue="not exited"]
11:14:23.609 [WaitForProcess-Process[pid=12143, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12143, exitValue=0] stopped with exit code 0
11:14:23.610 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Write a very long essay]
11:14:23.610 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:14:23.610 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Write a very long essay] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:14:23.612 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12159, exitValue="not exited"]
11:14:23.713 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Process[pid=12159, exitValue="not exited"] is running too long
11:14:23.713 [WaitForProcess-Process[pid=12159, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Stopping Process[pid=12159, exitValue="not exited"]...
11:14:23.713 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:14:23.713 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Expected timeout exception occurred: TransportException
11:14:23.713 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 2
11:14:23.713 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:23.715 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12174, exitValue="not exited"]
11:14:24.143 [WaitForProcess-Process[pid=12174, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12174, exitValue=0] stopped with exit code 0
11:14:24.143 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Hi]
11:14:24.143 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:14:24.143 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Hi] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:14:24.145 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12189, exitValue="not exited"]
11:14:29.109 [WaitForProcess-Process[pid=12189, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12189, exitValue=0] stopped with exit code 0
11:14:29.110 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:14:29.113 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:14:29.113 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Edge case validation completed
11:14:29.115 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Testing QueryResult convenience methods with real Claude CLI response
11:14:29.115 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 51
11:14:29.115 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:29.116 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12312, exitValue="not exited"]
11:14:29.551 [WaitForProcess-Process[pid=12312, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12312, exitValue=0] stopped with exit code 0
11:14:29.551 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Hello! Please say hello back and tell me your name.]
11:14:29.552 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:14:29.552 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Hello! Please say hello back and tell me your name.] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:14:29.553 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12327, exitValue="not exited"]
11:14:35.092 [WaitForProcess-Process[pid=12327, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12327, exitValue=0] stopped with exit code 0
11:14:35.093 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:14:35.093 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:14:35.096 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- QueryResult validation passed - Messages: 2, HasTools: false, Fast: false, Expensive: false
11:14:35.098 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Testing Metadata aggregation with real Claude CLI response
11:14:35.098 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 31
11:14:35.098 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:35.099 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12444, exitValue="not exited"]
11:14:35.535 [WaitForProcess-Process[pid=12444, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12444, exitValue=0] stopped with exit code 0
11:14:35.535 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Write a haiku about programming]
11:14:35.536 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:14:35.536 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Write a haiku about programming] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:14:35.537 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12460, exitValue="not exited"]
11:14:41.032 [WaitForProcess-Process[pid=12460, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12460, exitValue=0] stopped with exit code 0
11:14:41.033 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:14:41.034 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:14:41.036 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Metadata validation passed - Model: unknown, Duration: 4003ms, Efficiency: 0.006245316012990257 tokens/ms
11:14:41.038 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Testing Usage analytics with real Claude CLI response
11:14:41.038 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 92
11:14:41.038 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:41.039 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12583, exitValue="not exited"]
11:14:41.465 [WaitForProcess-Process[pid=12583, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12583, exitValue=0] stopped with exit code 0
11:14:41.465 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --append-system-prompt, Think step by step, --permission-mode, bypassPermissions, --, Solve this logic puzzle: If A is taller than B, and B is taller than C, who is the shortest?]
11:14:41.466 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:14:41.466 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --append-system-prompt, Think step by step, --permission-mode, bypassPermissions, --, Solve this logic puzzle: If A is taller than B, and B is taller than C, who is the shortest?] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:14:41.467 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12598, exitValue="not exited"]
11:14:46.226 [WaitForProcess-Process[pid=12598, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12598, exitValue=0] stopped with exit code 0
11:14:46.227 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:14:46.227 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:14:46.227 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Usage validation passed - Total: 64, Input: 3, Output: 61, Thinking: 0, Compression: 20.333333333333332
11:14:46.229 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Testing interactive session with multiple queries
11:14:46.230 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connecting to Claude CLI
11:14:46.230 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:46.232 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12714, exitValue="not exited"]
11:14:46.655 [WaitForProcess-Process[pid=12714, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12714, exitValue=0] stopped with exit code 0
11:14:46.655 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:46.656 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12729, exitValue="not exited"]
11:14:47.075 [WaitForProcess-Process[pid=12729, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12729, exitValue=0] stopped with exit code 0
11:14:47.075 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connected to Claude CLI version: 2.0.65 (Claude Code)
11:14:47.075 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:47.077 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12743, exitValue="not exited"]
11:14:47.453 [WaitForProcess-Process[pid=12743, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12743, exitValue=0] stopped with exit code 0
11:14:47.453 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Executing client query with prompt length: 12
11:14:47.453 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --dangerously-skip-permissions, --, What is 5+5?]
11:14:47.454 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:14:47.454 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --dangerously-skip-permissions, --, What is 5+5?] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:14:47.455 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12758, exitValue="not exited"]
11:14:51.619 [WaitForProcess-Process[pid=12758, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12758, exitValue=0] stopped with exit code 0
11:14:51.620 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:14:51.621 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Executing client query with prompt length: 13
11:14:51.621 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --dangerously-skip-permissions, --, What is 10*2?]
11:14:51.622 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:14:51.622 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --dangerously-skip-permissions, --, What is 10*2?] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:14:51.623 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12880, exitValue="not exited"]
11:14:56.177 [WaitForProcess-Process[pid=12880, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12880, exitValue=0] stopped with exit code 0
11:14:56.178 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:14:56.178 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Interactive session validation passed - Query1 cost: $0.0122675, Query2 cost: $0.012787750000000002
11:14:56.178 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Disconnecting from Claude CLI
11:14:56.178 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:14:56.178 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- ReactiveTransport closed
11:14:56.180 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Testing Cost calculations with real Claude CLI response
11:14:56.180 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 43
11:14:56.180 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:14:56.181 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=12997, exitValue="not exited"]
11:14:56.611 [WaitForProcess-Process[pid=12997, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=12997, exitValue=0] stopped with exit code 0
11:14:56.612 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, What is 2+2? Please explain your reasoning.]
11:14:56.612 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:14:56.612 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, What is 2+2? Please explain your reasoning.] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:14:56.614 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=13013, exitValue="not exited"]
11:15:01.794 [WaitForProcess-Process[pid=13013, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=13013, exitValue=0] stopped with exit code 0
11:15:01.794 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:15:01.795 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:15:01.795 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Cost validation passed - Total: $0.014114, Tokens: 54, Efficiency: 3613.4334703131644
11:15:01.796 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Testing streaming response calculations
11:15:01.796 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connecting to Claude CLI
11:15:01.796 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:15:01.798 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=13131, exitValue="not exited"]
11:15:02.235 [WaitForProcess-Process[pid=13131, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=13131, exitValue=0] stopped with exit code 0
11:15:02.236 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:15:02.237 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=13150, exitValue="not exited"]
11:15:02.668 [WaitForProcess-Process[pid=13150, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=13150, exitValue=0] stopped with exit code 0
11:15:02.668 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connected to Claude CLI version: 2.0.65 (Claude Code)
11:15:02.669 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Executing streaming client query with prompt length: 35
11:15:02.669 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, stream-json, --verbose, --dangerously-skip-permissions, --, Tell me a short story about a robot]
11:15:02.669 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found for streaming - Claude CLI may fail
11:15:02.669 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, stream-json, --verbose, --dangerously-skip-permissions, --, Tell me a short story about a robot] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:15:02.671 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=13167, exitValue="not exited"]
11:15:12.909 [WaitForProcess-Process[pid=13167, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=13167, exitValue=0] stopped with exit code 0
11:15:12.910 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Streaming query completed successfully
11:15:12.913 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Starting reactive streaming query
11:15:12.914 [main] DEBUG org.springaicommunity.claude.agent.sdk.resilience.ResilienceManager -- Starting resilient flux operation 'reactive-query'
11:15:12.914 [boundedElastic-2] INFO org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- Starting reactive query with BidirectionalTransport
11:15:12.914 [boundedElastic-2] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:12.914 [boundedElastic-2] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --dangerously-skip-permissions]
11:15:12.916 [boundedElastic-2] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:12.917 [boundedElastic-2] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Count from 1 to 5"}}
11:15:17.522 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.resilience.ResilienceManager -- Flux operation 'reactive-query' completed
11:15:17.522 [claude-inbound] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Reactive streaming query completed
11:15:17.523 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- Closing ephemeral transport on disposal
11:15:17.523 [main] INFO org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT -- Streaming validation passed - Callback messages: 3, Reactive messages: 3
11:15:17.523 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Disconnecting from Claude CLI
11:15:17.523 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:15:17.523 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- ReactiveTransport closed
[INFO] Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 54.35 s -- in org.springaicommunity.claude.agent.sdk.integration.DomainObjectIT
[INFO] Running org.springaicommunity.claude.agent.sdk.hooks.HookIntegrationIT
11:15:17.525 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:15:17.530 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash
11:15:17.530 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:17.530 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, default]
11:15:17.533 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:17.544 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"controlRequest":true,"type":"control_request","request_id":"init_1765480517533","request":{"subtype":"initialize","hooks":{"PreToolUse":[{"matcher":"Bash","hookCallbackIds":["hook_0"],"timeout":60}]}}}
11:15:18.045 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Run this bash command: echo 'hello from hook test'"}}
11:15:18.373 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:15:18.374 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:15:18.423 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control response: subtype=null, requestId=init_1765480517533
11:15:18.423 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control response: requestId=init_1765480517533, subtype=null
11:15:20.215 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=hook_callback, requestId=0b613eb8-9d6e-481b-81d5-5e71fa018b8f
11:15:20.215 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=hook_callback, requestId=0b613eb8-9d6e-481b-81d5-5e71fa018b8f
11:15:20.221 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Executing hook: id=hook_0, event=PRE_TOOL_USE
PreToolUse hook called for Bash!
11:15:20.222 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Hook result: id=hook_0, continue=true
11:15:20.226 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"0b613eb8-9d6e-481b-81d5-5e71fa018b8f","response":{"continue":true}}}
11:15:22.683 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:15:22.683 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
Hook invocations: [PreToolUse:Bash]
11:15:22.685 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash
11:15:22.685 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_1, event=POST_TOOL_USE, pattern=null
11:15:22.686 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash
11:15:22.687 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:22.687 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, default]
11:15:22.689 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:22.690 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"controlRequest":true,"type":"control_request","request_id":"init_1765480522689","request":{"subtype":"initialize","hooks":{"PreToolUse":[{"matcher":"Bash","hookCallbackIds":["hook_0"],"timeout":60}]}}}
11:15:23.191 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Execute this exact bash command right now: echo 'test123'"}}
11:15:23.647 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control response: subtype=null, requestId=init_1765480522689
11:15:23.648 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control response: requestId=init_1765480522689, subtype=null
11:15:25.091 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=hook_callback, requestId=b1d630a0-ff7d-41e7-8f33-4ff26c59d44f
11:15:25.091 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=hook_callback, requestId=b1d630a0-ff7d-41e7-8f33-4ff26c59d44f
11:15:25.091 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Executing hook: id=hook_0, event=PRE_TOOL_USE
PreToolUse hook BLOCKING Bash!
11:15:25.091 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Hook result: id=hook_0, continue=false
11:15:25.094 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"b1d630a0-ff7d-41e7-8f33-4ff26c59d44f","response":{"continue":false,"decision":"block","reason":"Bash commands are blocked by policy"}}}
11:15:28.863 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:15:28.863 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
Hook invocations: [PreToolUse:Bash:BLOCKED]
11:15:28.866 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_0, event=PRE_TOOL_USE, pattern=Bash
11:15:28.866 [main] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Registered hook: id=hook_1, event=POST_TOOL_USE, pattern=Bash
11:15:28.867 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:28.867 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, default]
11:15:28.869 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:28.870 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"controlRequest":true,"type":"control_request","request_id":"init_1765480528870","request":{"subtype":"initialize","hooks":{"PostToolUse":[{"matcher":"Bash","hookCallbackIds":["hook_1"],"timeout":60}],"PreToolUse":[{"matcher":"Bash","hookCallbackIds":["hook_0"],"timeout":60}]}}}
11:15:29.371 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Run this command: echo 'testing post hook'"}}
11:15:30.261 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control response: subtype=null, requestId=init_1765480528870
11:15:30.261 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control response: requestId=init_1765480528870, subtype=null
11:15:31.589 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=hook_callback, requestId=01e352c5-b3d8-4fa3-8001-e46895f20eef
11:15:31.589 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=hook_callback, requestId=01e352c5-b3d8-4fa3-8001-e46895f20eef
11:15:31.590 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Executing hook: id=hook_0, event=PRE_TOOL_USE
11:15:31.590 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Hook result: id=hook_0, continue=true
11:15:31.592 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"01e352c5-b3d8-4fa3-8001-e46895f20eef","response":{"continue":true}}}
11:15:31.624 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control request: type=control_request, subtype=hook_callback, requestId=6abfeefa-5baa-4690-86fb-9e68301a241d
11:15:31.625 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control request: type=hook_callback, requestId=6abfeefa-5baa-4690-86fb-9e68301a241d
11:15:31.628 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Executing hook: id=hook_1, event=POST_TOOL_USE
PostToolUse hook called for Bash!
11:15:31.628 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.hooks.HookRegistry -- Hook result: id=hook_1, continue=true
11:15:31.629 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending control response: {"type":"control_response","response":{"subtype":"success","subtype":"success","request_id":"6abfeefa-5baa-4690-86fb-9e68301a241d","response":{"continue":true}}}
11:15:33.415 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:15:33.415 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
Hook invocations: [PreToolUse:Bash, PostToolUse:Bash]
11:15:33.418 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:33.418 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:15:33.420 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:33.420 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hello in exactly 3 words"}}
11:15:37.316 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:15:37.316 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 19.79 s -- in org.springaicommunity.claude.agent.sdk.hooks.HookIntegrationIT
[INFO] Running org.springaicommunity.claude.agent.sdk.error.ErrorScenarioIntegrationIT
11:15:37.319 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:15:37.321 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:37.322 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:15:37.324 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:37.325 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"test"}}
11:15:38.682 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:15:42.588 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:15:42.590 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:42.590 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, default]
11:15:42.592 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:42.593 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 1 + 1?"}}
11:15:46.448 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:15:46.448 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:15:46.450 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:46.451 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/nonexistent/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:15:46.452 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:15:46.454 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:46.455 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:15:46.457 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:46.457 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Count to 1000"}}
11:15:58.430 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:15:58.837 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:15:58.839 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:15:58.839 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:15:58.841 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:15:58.841 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hi"}}
11:16:05.984 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:16:05.984 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:16:05.986 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:16:05.987 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:16:05.989 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:16:05.989 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hello"}}
11:16:09.293 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:16:09.293 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:16:09.296 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:16:09.296 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:16:09.298 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:16:09.298 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Count from 1 to 100 slowly"}}
11:16:10.525 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:16:29.161 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[INFO] Tests run: 7, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 51.84 s -- in org.springaicommunity.claude.agent.sdk.error.ErrorScenarioIntegrationIT
[INFO] Running org.springaicommunity.claude.agent.sdk.QuerySmokeIT
11:16:29.163 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:16:29.164 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 12
11:16:29.164 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:16:29.165 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=14697, exitValue="not exited"]
11:16:29.589 [WaitForProcess-Process[pid=14697, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=14697, exitValue=0] stopped with exit code 0
11:16:29.589 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, What is 1+1?]
11:16:29.589 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:16:29.589 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, What is 1+1?] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:16:29.591 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=14712, exitValue="not exited"]
11:16:49.137 [WaitForProcess-Process[pid=14712, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=14712, exitValue=0] stopped with exit code 0
11:16:49.138 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:16:49.138 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:16:49.140 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 12
11:16:49.140 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:16:49.141 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=14959, exitValue="not exited"]
11:16:49.565 [WaitForProcess-Process[pid=14959, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=14959, exitValue=0] stopped with exit code 0
11:16:49.565 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --append-system-prompt, You are a helpful math tutor., --permission-mode, bypassPermissions, --, What is 2+2?]
11:16:49.565 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:16:49.565 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --append-system-prompt, You are a helpful math tutor., --permission-mode, bypassPermissions, --, What is 2+2?] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:16:49.567 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=14974, exitValue="not exited"]
11:17:08.332 [WaitForProcess-Process[pid=14974, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=14974, exitValue=0] stopped with exit code 0
11:17:08.333 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:17:08.333 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:17:08.334 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --append-system-prompt, You are a helpful math tutor., --permission-mode, bypassPermissions, --, What is 2+2?].
11:17:08.335 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15116, exitValue="not exited"]
11:17:13.043 [WaitForProcess-Process[pid=15116, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15116, exitValue=0] stopped with exit code 0
Claude CLI sanity check completed in 4709 ms
Output length: 984 characters
11:17:13.045 [main] INFO org.springaicommunity.claude.agent.sdk.Query -- Executing query with prompt length: 13
11:17:13.045 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:13.047 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15240, exitValue="not exited"]
11:17:13.475 [WaitForProcess-Process[pid=15240, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15240, exitValue=0] stopped with exit code 0
11:17:13.475 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Hello, world!]
11:17:13.476 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:17:13.476 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --permission-mode, bypassPermissions, --, Hello, world!] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:17:13.477 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15255, exitValue="not exited"]
11:17:17.711 [WaitForProcess-Process[pid=15255, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15255, exitValue=0] stopped with exit code 0
11:17:17.712 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:17:17.712 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 48.55 s -- in org.springaicommunity.claude.agent.sdk.QuerySmokeIT
[INFO] Running org.springaicommunity.claude.agent.sdk.ClaudeAgentClientIT
11:17:17.715 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:17:17.715 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connecting to Claude CLI
11:17:17.715 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:17.717 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15372, exitValue="not exited"]
11:17:18.142 [WaitForProcess-Process[pid=15372, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15372, exitValue=0] stopped with exit code 0
11:17:18.142 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:18.144 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15386, exitValue="not exited"]
11:17:18.558 [WaitForProcess-Process[pid=15386, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15386, exitValue=0] stopped with exit code 0
11:17:18.558 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connected to Claude CLI version: 2.0.65 (Claude Code)
11:17:18.558 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:18.560 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15401, exitValue="not exited"]
11:17:18.909 [WaitForProcess-Process[pid=15401, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15401, exitValue=0] stopped with exit code 0
11:17:18.910 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Disconnecting from Claude CLI
11:17:18.910 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:17:18.910 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- ReactiveTransport closed
11:17:18.911 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connecting to Claude CLI
11:17:18.911 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:18.912 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15415, exitValue="not exited"]
11:17:19.170 [WaitForProcess-Process[pid=15415, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15415, exitValue=0] stopped with exit code 0
11:17:19.171 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:19.171 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15429, exitValue="not exited"]
11:17:19.405 [WaitForProcess-Process[pid=15429, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15429, exitValue=0] stopped with exit code 0
11:17:19.406 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connected to Claude CLI version: 2.0.65 (Claude Code)
11:17:19.406 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Executing client query with prompt length: 12
11:17:19.406 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --dangerously-skip-permissions, --, What is 3+3?]
11:17:19.406 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:17:19.406 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --dangerously-skip-permissions, --, What is 3+3?] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:17:19.407 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15444, exitValue="not exited"]
11:17:23.884 [WaitForProcess-Process[pid=15444, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15444, exitValue=0] stopped with exit code 0
11:17:23.885 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:17:23.885 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Disconnecting from Claude CLI
11:17:23.885 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:17:23.885 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- ReactiveTransport closed
11:17:23.886 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connecting to Claude CLI
11:17:23.886 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:23.888 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15567, exitValue="not exited"]
11:17:24.314 [WaitForProcess-Process[pid=15567, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15567, exitValue=0] stopped with exit code 0
11:17:24.315 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:24.316 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15581, exitValue="not exited"]
11:17:24.737 [WaitForProcess-Process[pid=15581, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15581, exitValue=0] stopped with exit code 0
11:17:24.738 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connected to Claude CLI version: 2.0.65 (Claude Code)
11:17:24.738 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Executing client query with prompt length: 30
11:17:24.738 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, json, --append-system-prompt, You are a helpful assistant., --permission-mode, bypassPermissions, --, What is the capital of France?]
11:17:24.738 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found - Claude CLI may fail
11:17:24.738 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, json, --append-system-prompt, You are a helpful assistant., --permission-mode, bypassPermissions, --, What is the capital of France?] in /home/mark/community/claude-agent-sdk-java/claude-code-sdk with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:17:24.739 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15599, exitValue="not exited"]
11:17:29.730 [WaitForProcess-Process[pid=15599, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15599, exitValue=0] stopped with exit code 0
11:17:29.730 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Query completed successfully with 2 messages
11:17:29.730 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Disconnecting from Claude CLI
11:17:29.730 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:17:29.730 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- ReactiveTransport closed
11:17:29.732 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connecting to Claude CLI
11:17:29.732 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:29.733 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15718, exitValue="not exited"]
11:17:30.151 [WaitForProcess-Process[pid=15718, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15718, exitValue=0] stopped with exit code 0
11:17:30.151 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --version].
11:17:30.153 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15732, exitValue="not exited"]
11:17:30.571 [WaitForProcess-Process[pid=15732, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15732, exitValue=0] stopped with exit code 0
11:17:30.571 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Connected to Claude CLI version: 2.0.65 (Claude Code)
11:17:30.572 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Executing streaming client query with prompt length: 14
11:17:30.572 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport --  CLAUDE CLI COMMAND: [/home/mark/.local/bin/claude, --print, --output-format, stream-json, --verbose, --dangerously-skip-permissions, --, Tell me a joke]
11:17:30.572 [main] WARN org.springaicommunity.claude.agent.sdk.transport.CLITransport -- ANTHROPIC_API_KEY environment variable not found for streaming - Claude CLI may fail
11:17:30.572 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --print, --output-format, stream-json, --verbose, --dangerously-skip-permissions, --, Tell me a joke] in . with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:17:30.573 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=15747, exitValue="not exited"]
11:17:35.878 [WaitForProcess-Process[pid=15747, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=15747, exitValue=0] stopped with exit code 0
11:17:35.879 [main] INFO org.springaicommunity.claude.agent.sdk.transport.CLITransport -- Streaming query completed successfully
11:17:35.879 [main] INFO org.springaicommunity.claude.agent.sdk.ClaudeAgentClient -- Disconnecting from Claude CLI
11:17:35.879 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.CLITransport -- CLITransport closed
11:17:35.879 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.ReactiveTransport -- ReactiveTransport closed
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 18.17 s -- in org.springaicommunity.claude.agent.sdk.ClaudeAgentClientIT
[INFO] Running org.springaicommunity.claude.agent.sdk.session.MessageReceiverPatternIT
11:17:35.881 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:17:35.921 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:17:35.921 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:17:35.924 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:17:35.925 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"My favorite color is blue. Remember this."}}
11:17:35.925 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: My favorite color is blue. Remember this.
11:17:38.974 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"type":"user","message":{"role":"user","content":"What is my favorite color?"},"parent_tool_use_id":null,"session_id":"default"}
11:17:38.974 [main] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Sent query in session default: What is my favorite color?
11:17:40.915 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:17:40.915 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:17:40.915 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:17:40.915 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:17:42.313 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:17:42.313 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:17:42.314 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:17:42.316 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:17:42.316 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:17:42.318 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:17:42.318 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say 'hello' in one word."}}
11:17:42.318 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: Say 'hello' in one word.
11:17:44.115 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:17:44.115 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:17:44.115 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:17:44.115 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:17:45.377 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:17:45.377 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:17:45.377 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:17:45.381 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:17:45.381 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:17:45.383 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:17:45.383 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 2+2? Reply with just the number."}}
11:17:45.383 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: What is 2+2? Reply with just the number.
Got first message: RegularMessage[message=SystemMessage[subtype=init, data={mcp_servers=[], plugins=[], apiKeySource=none, session_id=1dcdd1f1-77ff-49dd-aa99-83db921cf250, tools=[Task, TaskOutput, Bash, Glob, Grep, ExitPlanMode, Read, Edit, Write, NotebookEdit, WebFetch, TodoWrite, WebSearch, KillShell, Skill, SlashCommand, EnterPlanMode], uuid=6e30591c-a002-47c1-8b73-ff3f2f380d8d, slash_commands=[compact, context, cost, init, pr-comments, release-notes, review, security-review], agents=[general-purpose, statusline-setup, Explore, Plan, claude-code-guide], skills=[], cwd=/home/mark/community/claude-agent-sdk-java/claude-code-sdk, permissionMode=bypassPermissions, model=claude-haiku-4-5-20251001, claude_code_version=2.0.65, output_style=default}]]
11:17:46.315 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:17:46.315 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:17:46.315 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:17:46.315 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:17:47.799 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:17:49.766 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:17:49.766 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:17:49.768 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:17:49.768 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:17:49.770 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:17:49.771 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 2+2? Reply with just the number."}}
11:17:49.771 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: What is 2+2? Reply with just the number.
Received: RegularMessage[message=SystemMessage[subtype=init, data={mcp_servers=[], plugins=[], apiKeySource=none, session_id=66d4e12c-55b3-42fb-a480-586ac3fc5fb1, tools=[Task, TaskOutput, Bash, Glob, Grep, ExitPlanMode, Read, Edit, Write, NotebookEdit, WebFetch, TodoWrite, WebSearch, KillShell, Skill, SlashCommand, EnterPlanMode], uuid=28b5e4d7-2d65-43dd-b683-747dd5e9f6cf, slash_commands=[compact, context, cost, init, pr-comments, release-notes, review, security-review], agents=[general-purpose, statusline-setup, Explore, Plan, claude-code-guide], skills=[], cwd=/home/mark/community/claude-agent-sdk-java/claude-code-sdk, permissionMode=bypassPermissions, model=claude-haiku-4-5-20251001, claude_code_version=2.0.65, output_style=default}]]
Received: RegularMessage[message=AssistantMessage[content=[TextBlock[text=4]]]]
Received: RegularMessage[message=ResultMessage[subtype=success, durationMs=828, durationApiMs=814, isError=false, numTurns=1, sessionId=66d4e12c-55b3-42fb-a480-586ac3fc5fb1, totalCostUsd=0.0018334000000000002, usage={server_tool_use={web_fetch_requests=0.0, web_search_requests=0.0}, output_tokens=5.0, service_tier=standard, cache_creation={ephemeral_1h_input_tokens=0.0, ephemeral_5m_input_tokens=0.0}, cache_creation_input_tokens=0.0, input_tokens=3.0, cache_read_input_tokens=18054.0}, result=4, structuredOutput=null]]
11:17:51.760 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:17:51.760 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:17:51.760 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:17:51.760 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:17:52.111 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:17:52.111 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:17:52.111 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 16.23 s -- in org.springaicommunity.claude.agent.sdk.session.MessageReceiverPatternIT
[INFO] Running org.springaicommunity.claude.agent.sdk.session.IteratorPatternIT
11:17:52.114 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:17:52.115 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:17:52.115 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:17:52.117 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:17:52.118 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 5+5? Just the number."}}
11:17:52.118 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: What is 5+5? Just the number.
11:17:54.287 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:17:54.287 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:17:54.287 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:17:54.287 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:17:54.488 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:17:54.488 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:17:54.488 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:17:54.490 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:17:54.490 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:17:54.492 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:17:54.493 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is 2+2? Reply with just the number."}}
11:17:54.493 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: What is 2+2? Reply with just the number.
Received: RegularMessage[message=SystemMessage[subtype=init, data={mcp_servers=[], plugins=[], apiKeySource=none, session_id=d39897ee-2c28-450e-ac73-d20acb74cd5c, tools=[Task, TaskOutput, Bash, Glob, Grep, ExitPlanMode, Read, Edit, Write, NotebookEdit, WebFetch, TodoWrite, WebSearch, KillShell, Skill, SlashCommand, EnterPlanMode], uuid=1b54c7b4-dd05-49e6-82a4-473abdcd6dc8, slash_commands=[compact, context, cost, init, pr-comments, release-notes, review, security-review], agents=[general-purpose, statusline-setup, Explore, Plan, claude-code-guide], skills=[], cwd=/home/mark/community/claude-agent-sdk-java/claude-code-sdk, permissionMode=bypassPermissions, model=claude-haiku-4-5-20251001, claude_code_version=2.0.65, output_style=default}]]
Received: RegularMessage[message=AssistantMessage[content=[TextBlock[text=4]]]]
Received: RegularMessage[message=ResultMessage[subtype=success, durationMs=851, durationApiMs=841, isError=false, numTurns=1, sessionId=d39897ee-2c28-450e-ac73-d20acb74cd5c, totalCostUsd=0.0018334000000000002, usage={server_tool_use={web_fetch_requests=0.0, web_search_requests=0.0}, output_tokens=5.0, service_tier=standard, cache_creation={ephemeral_1h_input_tokens=0.0, ephemeral_5m_input_tokens=0.0}, cache_creation_input_tokens=0.0, input_tokens=3.0, cache_read_input_tokens=18054.0}, result=4, structuredOutput=null]]
11:17:56.358 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:17:56.358 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:17:56.358 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:17:56.358 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:17:56.615 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:17:56.615 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:17:56.615 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:17:56.617 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:17:56.617 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:17:56.621 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:17:56.621 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say 'hello' in one word."}}
11:17:56.621 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: Say 'hello' in one word.
11:17:58.828 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:17:58.828 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:17:58.828 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:17:58.828 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:17:59.086 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:17:59.087 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:17:59.087 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:17:59.089 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:17:59.089 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:17:59.091 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:17:59.091 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"My favorite color is blue. Remember this."}}
11:17:59.091 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: My favorite color is blue. Remember this.
11:18:02.233 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"type":"user","message":{"role":"user","content":"What is my favorite color?"},"parent_tool_use_id":null,"session_id":"default"}
11:18:02.233 [main] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Sent query in session default: What is my favorite color?
11:18:04.105 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:18:04.106 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:18:04.106 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:18:04.106 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:18:04.390 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:04.390 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:04.390 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 12.28 s -- in org.springaicommunity.claude.agent.sdk.session.IteratorPatternIT
[INFO] Running org.springaicommunity.claude.agent.sdk.session.SessionControlIT
11:18:04.393 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:18:04.395 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:04.395 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:04.397 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:04.397 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Hello"}}
11:18:04.397 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: Hello
11:18:04.402 [main] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Sending control request: subtype=set_permission_mode, requestId=8689b47f-0
11:18:04.402 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"type":"control_request","request_id":"8689b47f-0","request":{"mode":"acceptEdits","subtype":"set_permission_mode"}}
11:18:05.216 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control response: subtype=null, requestId=8689b47f-0
11:18:05.216 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control response: requestId=8689b47f-0, subtype=null
11:18:05.216 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Handling control response: requestId=8689b47f-0, subtype=null
11:18:05.216 [main] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Sending control request: subtype=set_model, requestId=8689b47f-1
11:18:05.217 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"type":"control_request","request_id":"8689b47f-1","request":{"subtype":"set_model","model":"claude-3-5-haiku-20241022"}}
11:18:05.217 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Control response delivered for requestId=8689b47f-0
11:18:05.218 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control response: subtype=null, requestId=8689b47f-0
11:18:05.218 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control response: requestId=8689b47f-0, subtype=null
11:18:05.218 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Handling control response: requestId=8689b47f-0, subtype=null
11:18:05.218 [claude-inbound] WARN org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Unexpected response for unknown request id 8689b47f-0
11:18:05.232 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.parsing.ControlMessageParser -- Parsed control response: subtype=null, requestId=8689b47f-1
11:18:05.232 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Received control response: requestId=8689b47f-1, subtype=null
11:18:05.232 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Handling control response: requestId=8689b47f-1, subtype=null
11:18:05.232 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Control response delivered for requestId=8689b47f-1
11:18:05.232 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"type":"user","message":{"role":"user","content":"What is 2+2?"},"parent_tool_use_id":null,"session_id":"default"}
11:18:05.232 [main] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Sent query in session default: What is 2+2?
11:18:05.233 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:18:05.233 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:18:05.233 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:18:05.233 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:18:08.685 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:14.580 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:14.580 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:18:14.587 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:14.587 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:14.589 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:14.589 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hello in exactly three words"}}
11:18:17.184 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:17.184 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:17.186 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:17.186 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:17.188 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:17.189 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say 'hi'"}}
11:18:19.329 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:19.329 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:19.331 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:19.331 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:19.333 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:19.334 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Count from 1 to 1000"}}
11:18:21.334 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTED -> CLOSING
11:18:21.361 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:21.361 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:21.363 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:21.363 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:21.365 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:21.365 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"My name is TestUser. Remember this."}}
11:18:23.443 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is my name?"}}
11:18:25.926 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:25.926 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:25.928 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:25.928 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:25.930 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:25.931 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Hello"}}
11:18:25.931 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: Hello
11:18:25.931 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:18:25.931 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:18:25.931 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:18:25.931 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:18:27.218 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:29.864 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:29.864 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
11:18:29.865 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:29.865 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:29.868 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:29.868 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"My favorite number is 42. Remember this."}}
11:18:29.868 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session connected with prompt: My favorite number is 42. Remember this.
11:18:32.868 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending message: {"type":"user","message":{"role":"user","content":"What is my favorite number?"},"parent_tool_use_id":null,"session_id":"default"}
11:18:32.868 [main] DEBUG org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Sent query in session default: What is my favorite number?
11:18:33.951 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Stream completed
11:18:33.951 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.MessageStreamIterator -- Iterator closed
11:18:33.951 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Stream completed
11:18:33.952 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.BlockingMessageReceiver -- Receiver closed
11:18:34.198 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:34.198 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:34.198 [main] INFO org.springaicommunity.claude.agent.sdk.session.DefaultClaudeSession -- Session closed
[INFO] Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 29.81 s -- in org.springaicommunity.claude.agent.sdk.session.SessionControlIT
[INFO] Running org.springaicommunity.claude.agent.sdk.session.SessionIntegrationIT
11:18:34.201 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:18:34.203 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:34.203 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:34.205 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:34.206 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Say hi"}}
11:18:37.492 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:37.493 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:37.495 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:37.495 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:37.497 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:37.498 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What color is the sky? Answer in one word."}}
11:18:40.687 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:40.688 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:40.689 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:40.690 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:40.692 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:40.692 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"My name is Alice. Please remember this."}}
11:18:43.493 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"What is my name?"}}
11:18:43.493 [claude-outbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Dropping message - transport closing or closed
11:18:43.768 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:43.768 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
11:18:43.771 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: DISCONNECTED -> CONNECTING
11:18:43.771 [main] INFO org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Starting bidirectional session: [/home/mark/.local/bin/claude, --input-format, stream-json, --output-format, stream-json, --permission-prompt-tool, stdio, --verbose, --model, claude-haiku-4-5-20251001, --permission-mode, bypassPermissions]
11:18:43.773 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- State transition: CONNECTING -> CONNECTED
11:18:43.773 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Sending user message: {"session_id":"default","type":"user","message":{"role":"user","content":"Tell me a very short joke (one line only)"}}
11:18:46.570 [claude-inbound] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- Message processing loop ended
11:18:46.571 [main] DEBUG org.springaicommunity.claude.agent.sdk.transport.BidirectionalTransport -- BidirectionalTransport closed
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 12.37 s -- in org.springaicommunity.claude.agent.sdk.session.SessionIntegrationIT
[INFO] Running org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT
11:18:46.573 [main] INFO org.springaicommunity.claude.agent.sdk.test.ClaudeCliTestBase -- Claude CLI tests will use executable at: /home/mark/.local/bin/claude
11:18:46.574 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: SystemMessage in state: AWAITING_INIT
11:18:46.575 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream initialized with session ID: test123
11:18:46.575 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: AssistantMessage in state: AWAITING_CONTENT
11:18:46.575 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Received assistant message with 1 content blocks
11:18:46.575 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: ResultMessage in state: AWAITING_CONTENT
11:18:46.575 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed: 1000 ms duration, 3 messages, session: test123
11:18:46.575 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed successfully
11:18:46.575 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT -- State machine test completed:
11:18:46.575 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Final state: COMPLETED
11:18:46.575 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Total messages: 3
11:18:46.575 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Session ID: test123
11:18:46.576 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT -- Testing robust streaming with prompt: What is 2+2? Be concise.
11:18:46.578 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Started robust streaming processor for format: STREAM_JSON
11:18:46.579 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --output-format, stream-json, --verbose, --print, What is 2+2? Be concise.] with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:18:46.580 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=18124, exitValue="not exited"]
11:18:47.598 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: SystemMessage (parse attempts: 1/1)
11:18:47.598 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: SystemMessage in state: AWAITING_INIT
11:18:47.598 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream initialized with session ID: 73721d63-6a0f-4e32-9677-49f491c4fe3e
11:18:47.598 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 1 of type: SystemMessage
11:18:50.474 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: AssistantMessage (parse attempts: 2/2)
11:18:50.474 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: AssistantMessage in state: AWAITING_CONTENT
11:18:50.474 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Received assistant message with 1 content blocks
11:18:50.474 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 2 of type: AssistantMessage
11:18:50.588 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: ResultMessage (parse attempts: 3/3)
11:18:50.588 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: ResultMessage in state: AWAITING_CONTENT
11:18:50.588 [Thread-73] INFO org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed: 3000 ms duration, 3 messages, session: 73721d63-6a0f-4e32-9677-49f491c4fe3e
11:18:50.588 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed successfully
11:18:50.588 [Thread-73] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 3 of type: ResultMessage
11:18:50.589 [Thread-73] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream completed successfully after 3 messages
11:18:50.694 [ForkJoinPool.commonPool-worker-2] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Auto-closing stream after completion
11:18:50.694 [ForkJoinPool.commonPool-worker-2] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 3, Messages: 3, Errors: 0
11:18:50.695 [ForkJoinPool.commonPool-worker-2] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation successful: 3 messages in 4011 ms
11:18:50.695 [ForkJoinPool.commonPool-worker-2] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 4118 ms, Lines: 3, Messages: 3, Errors: 0
11:18:50.695 [ForkJoinPool.commonPool-worker-2] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:18:50.696 [ForkJoinPool.commonPool-worker-2] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: COMPLETED, Session: 73721d63-6a0f-4e32-9677-49f491c4fe3e
11:18:51.634 [WaitForProcess-Process[pid=18124, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=18124, exitValue=0] stopped with exit code 0
11:18:51.635 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 3, Messages: 3, Errors: 0
11:18:51.635 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation successful: 3 messages in 4011 ms
11:18:51.635 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 5058 ms, Lines: 3, Messages: 3, Errors: 0
11:18:51.635 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:18:51.635 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: COMPLETED, Session: 73721d63-6a0f-4e32-9677-49f491c4fe3e
11:18:51.636 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT -- Robust streaming test completed successfully:
11:18:51.636 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Duration: 5058 ms
11:18:51.636 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Messages: 3 (expected 3)
11:18:51.636 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Flow: SystemMessage -> AssistantMessage -> ResultMessage
11:18:51.636 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Processor stats: 3 lines, 3 messages, 0 errors
11:18:51.637 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT -- Testing prompt 1/3: What is 3+3?
11:18:51.638 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Started robust streaming processor for format: STREAM_JSON
11:18:51.638 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --output-format, stream-json, --verbose, --print, What is 3+3?] with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:18:51.639 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=18242, exitValue="not exited"]
11:18:52.614 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: SystemMessage (parse attempts: 1/1)
11:18:52.614 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: SystemMessage in state: AWAITING_INIT
11:18:52.614 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream initialized with session ID: 0d21e371-22ea-438f-ab95-b278fa18068e
11:18:52.614 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 1 of type: SystemMessage
11:18:55.505 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: AssistantMessage (parse attempts: 2/2)
11:18:55.505 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: AssistantMessage in state: AWAITING_CONTENT
11:18:55.505 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Received assistant message with 1 content blocks
11:18:55.505 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 2 of type: AssistantMessage
11:18:55.598 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: ResultMessage (parse attempts: 3/3)
11:18:55.598 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: ResultMessage in state: AWAITING_CONTENT
11:18:55.598 [Thread-75] INFO org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed: 2993 ms duration, 3 messages, session: 0d21e371-22ea-438f-ab95-b278fa18068e
11:18:55.598 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed successfully
11:18:55.598 [Thread-75] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 3 of type: ResultMessage
11:18:55.598 [Thread-75] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream completed successfully after 3 messages
11:18:55.698 [ForkJoinPool.commonPool-worker-2] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Auto-closing stream after completion
11:18:55.698 [ForkJoinPool.commonPool-worker-2] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 3, Messages: 3, Errors: 0
11:18:55.698 [ForkJoinPool.commonPool-worker-2] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation successful: 3 messages in 3960 ms
11:18:55.698 [ForkJoinPool.commonPool-worker-2] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 4060 ms, Lines: 3, Messages: 3, Errors: 0
11:18:55.698 [ForkJoinPool.commonPool-worker-2] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:18:55.699 [ForkJoinPool.commonPool-worker-2] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: COMPLETED, Session: 0d21e371-22ea-438f-ab95-b278fa18068e
11:18:55.991 [WaitForProcess-Process[pid=18242, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=18242, exitValue=0] stopped with exit code 0
11:18:55.992 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 3, Messages: 3, Errors: 0
11:18:55.992 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation successful: 3 messages in 3960 ms
11:18:55.992 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 4354 ms, Lines: 3, Messages: 3, Errors: 0
11:18:55.992 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:18:55.992 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: COMPLETED, Session: 0d21e371-22ea-438f-ab95-b278fa18068e
11:18:55.992 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Prompt 1 completed: 3 messages
11:18:55.992 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT -- Testing prompt 2/3: List 2 colors.
11:18:55.993 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Started robust streaming processor for format: STREAM_JSON
11:18:55.993 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --output-format, stream-json, --verbose, --print, List 2 colors.] with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:18:55.994 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=18366, exitValue="not exited"]
11:18:56.886 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: SystemMessage (parse attempts: 1/1)
11:18:56.887 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: SystemMessage in state: AWAITING_INIT
11:18:56.887 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream initialized with session ID: 4a525955-c2ae-41a8-aac6-8dea4eb84075
11:18:56.887 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 1 of type: SystemMessage
11:18:59.578 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: AssistantMessage (parse attempts: 2/2)
11:18:59.578 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: AssistantMessage in state: AWAITING_CONTENT
11:18:59.578 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Received assistant message with 1 content blocks
11:18:59.578 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 2 of type: AssistantMessage
11:18:59.620 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: ResultMessage (parse attempts: 3/3)
11:18:59.620 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: ResultMessage in state: AWAITING_CONTENT
11:18:59.620 [Thread-76] INFO org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed: 2745 ms duration, 3 messages, session: 4a525955-c2ae-41a8-aac6-8dea4eb84075
11:18:59.620 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed successfully
11:18:59.620 [Thread-76] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 3 of type: ResultMessage
11:18:59.620 [Thread-76] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream completed successfully after 3 messages
11:18:59.721 [ForkJoinPool.commonPool-worker-1] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Auto-closing stream after completion
11:18:59.721 [ForkJoinPool.commonPool-worker-1] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 3, Messages: 3, Errors: 0
11:18:59.721 [ForkJoinPool.commonPool-worker-1] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation successful: 3 messages in 3627 ms
11:18:59.721 [ForkJoinPool.commonPool-worker-1] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 3728 ms, Lines: 3, Messages: 3, Errors: 0
11:18:59.721 [ForkJoinPool.commonPool-worker-1] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:18:59.721 [ForkJoinPool.commonPool-worker-1] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: COMPLETED, Session: 4a525955-c2ae-41a8-aac6-8dea4eb84075
11:19:00.033 [WaitForProcess-Process[pid=18366, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=18366, exitValue=0] stopped with exit code 0
11:19:00.033 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 3, Messages: 3, Errors: 0
11:19:00.033 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation successful: 3 messages in 3627 ms
11:19:00.033 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 4040 ms, Lines: 3, Messages: 3, Errors: 0
11:19:00.033 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:19:00.033 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: COMPLETED, Session: 4a525955-c2ae-41a8-aac6-8dea4eb84075
11:19:00.034 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Prompt 2 completed: 3 messages
11:19:00.034 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT -- Testing prompt 3/3: Say hello.
11:19:00.034 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Started robust streaming processor for format: STREAM_JSON
11:19:00.034 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Executing [/home/mark/.local/bin/claude, --output-format, stream-json, --verbose, --print, Say hello.] with environment {CLAUDE_CODE_ENTRYPOINT=sdk-java}.
11:19:00.035 [main] DEBUG org.zeroturnaround.exec.ProcessExecutor -- Started Process[pid=18490, exitValue="not exited"]
11:19:01.202 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: SystemMessage (parse attempts: 1/1)
11:19:01.202 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: SystemMessage in state: AWAITING_INIT
11:19:01.202 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream initialized with session ID: 234d4e88-adf1-4ff9-bdba-79fc97cbd998
11:19:01.202 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 1 of type: SystemMessage
11:19:04.027 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: AssistantMessage (parse attempts: 2/2)
11:19:04.027 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: AssistantMessage in state: AWAITING_CONTENT
11:19:04.027 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Received assistant message with 1 content blocks
11:19:04.027 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 2 of type: AssistantMessage
11:19:04.089 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: ResultMessage (parse attempts: 3/3)
11:19:04.089 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: ResultMessage in state: AWAITING_CONTENT
11:19:04.089 [Thread-77] INFO org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed: 2895 ms duration, 3 messages, session: 234d4e88-adf1-4ff9-bdba-79fc97cbd998
11:19:04.089 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream completed successfully
11:19:04.089 [Thread-77] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 3 of type: ResultMessage
11:19:04.089 [Thread-77] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream completed successfully after 3 messages
11:19:04.189 [ForkJoinPool.commonPool-worker-1] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Auto-closing stream after completion
11:19:04.190 [ForkJoinPool.commonPool-worker-1] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 3, Messages: 3, Errors: 0
11:19:04.190 [ForkJoinPool.commonPool-worker-1] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation successful: 3 messages in 4055 ms
11:19:04.190 [ForkJoinPool.commonPool-worker-1] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 4156 ms, Lines: 3, Messages: 3, Errors: 0
11:19:04.190 [ForkJoinPool.commonPool-worker-1] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:19:04.190 [ForkJoinPool.commonPool-worker-1] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: COMPLETED, Session: 234d4e88-adf1-4ff9-bdba-79fc97cbd998
11:19:04.305 [WaitForProcess-Process[pid=18490, exitValue="not exited"]] DEBUG org.zeroturnaround.exec.WaitForProcess -- Process[pid=18490, exitValue=0] stopped with exit code 0
11:19:04.305 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 3, Messages: 3, Errors: 0
11:19:04.305 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation successful: 3 messages in 4055 ms
11:19:04.305 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 4271 ms, Lines: 3, Messages: 3, Errors: 0
11:19:04.305 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:19:04.305 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: COMPLETED, Session: 234d4e88-adf1-4ff9-bdba-79fc97cbd998
11:19:04.305 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Prompt 3 completed: 3 messages
11:19:04.307 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Started robust streaming processor for format: STREAM_JSON
11:19:04.308 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 1, Messages: 0, Errors: 0
11:19:04.308 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Flushing buffer with 35 characters remaining
11:19:04.308 [main] WARN org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Discarding unparseable buffer content: invalid line that should be ignored
11:19:04.308 [main] WARN org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation failed: Stream incomplete: AWAITING_INIT
11:19:04.308 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 1 ms, Lines: 1, Messages: 0, Errors: 0
11:19:04.308 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 0.0
11:19:04.308 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: AWAITING_INIT, Session: null
11:19:04.309 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Started robust streaming processor for format: STREAM_JSON
11:19:04.309 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: SystemMessage (parse attempts: 1/1)
11:19:04.309 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Processing message type: SystemMessage in state: AWAITING_INIT
11:19:04.309 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.StreamingStateMachine -- Stream initialized with session ID: test123
11:19:04.309 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Emitted message 1 of type: SystemMessage
11:19:04.309 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Closing streaming processor. Lines: 1, Messages: 1, Errors: 0
11:19:04.309 [main] WARN org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Stream validation failed: Stream incomplete: AWAITING_CONTENT
11:19:04.309 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Streaming completed - Duration: 0 ms, Lines: 1, Messages: 1, Errors: 0
11:19:04.309 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Parser stats - Success rate: {:.2f}%, Total chars: 100.0
11:19:04.309 [main] DEBUG org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingProcessor -- Final state: AWAITING_CONTENT, Session: test123
11:19:04.309 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT -- Error recovery test completed:
11:19:04.309 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Lines processed: 1
11:19:04.309 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Messages emitted: 1
11:19:04.309 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Errors handled: 0
11:19:04.310 [main] DEBUG org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Successfully parsed message type: SystemMessage (parse attempts: 1/2)
11:19:04.323 [main] WARN org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser -- Failed to parse message structure, clearing buffer. JSON preview: {"type":"assistant","content":[{"type":"text","text":"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
org.springaicommunity.claude.agent.sdk.exceptions.MessageParseException: Missing 'message' field in assistant message
	at org.springaicommunity.claude.agent.sdk.parsing.MessageParser.parseAssistantMessage(MessageParser.java:103)
	at org.springaicommunity.claude.agent.sdk.parsing.MessageParser.parseMessageFromNode(MessageParser.java:70)
	at org.springaicommunity.claude.agent.sdk.parsing.MessageParser.parseMessage(MessageParser.java:52)
	at org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser.attemptParse(RobustStreamParser.java:128)
	at org.springaicommunity.claude.agent.sdk.parsing.RobustStreamParser.accumulateAndParse(RobustStreamParser.java:106)
	at org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT.testParserBufferManagement(RobustStreamingIT.java:221)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.junit.platform.commons.util.ReflectionUtils.invokeMethod(ReflectionUtils.java:728)
	at org.junit.jupiter.engine.execution.MethodInvocation.proceed(MethodInvocation.java:60)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$ValidatingInvocation.proceed(InvocationInterceptorChain.java:131)
	at org.junit.jupiter.engine.extension.TimeoutExtension.intercept(TimeoutExtension.java:156)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestableMethod(TimeoutExtension.java:147)
	at org.junit.jupiter.engine.extension.TimeoutExtension.interceptTestMethod(TimeoutExtension.java:86)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker$ReflectiveInterceptorCall.lambda$ofVoidMethod$0(InterceptingExecutableInvoker.java:103)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.lambda$invoke$0(InterceptingExecutableInvoker.java:93)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain$InterceptedInvocation.proceed(InvocationInterceptorChain.java:106)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.proceed(InvocationInterceptorChain.java:64)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.chainAndInvoke(InvocationInterceptorChain.java:45)
	at org.junit.jupiter.engine.execution.InvocationInterceptorChain.invoke(InvocationInterceptorChain.java:37)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:92)
	at org.junit.jupiter.engine.execution.InterceptingExecutableInvoker.invoke(InterceptingExecutableInvoker.java:86)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.lambda$invokeTestMethod$7(TestMethodTestDescriptor.java:218)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.invokeTestMethod(TestMethodTestDescriptor.java:214)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:139)
	at org.junit.jupiter.engine.descriptor.TestMethodTestDescriptor.execute(TestMethodTestDescriptor.java:69)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:151)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1596)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.invokeAll(SameThreadHierarchicalTestExecutorService.java:41)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$6(NodeTestTask.java:155)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$8(NodeTestTask.java:141)
	at org.junit.platform.engine.support.hierarchical.Node.around(Node.java:137)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.lambda$executeRecursively$9(NodeTestTask.java:139)
	at org.junit.platform.engine.support.hierarchical.ThrowableCollector.execute(ThrowableCollector.java:73)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.executeRecursively(NodeTestTask.java:138)
	at org.junit.platform.engine.support.hierarchical.NodeTestTask.execute(NodeTestTask.java:95)
	at org.junit.platform.engine.support.hierarchical.SameThreadHierarchicalTestExecutorService.submit(SameThreadHierarchicalTestExecutorService.java:35)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestExecutor.execute(HierarchicalTestExecutor.java:57)
	at org.junit.platform.engine.support.hierarchical.HierarchicalTestEngine.execute(HierarchicalTestEngine.java:54)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:198)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:169)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:93)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.lambda$execute$0(EngineExecutionOrchestrator.java:58)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.withInterceptedStreams(EngineExecutionOrchestrator.java:141)
	at org.junit.platform.launcher.core.EngineExecutionOrchestrator.execute(EngineExecutionOrchestrator.java:57)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:103)
	at org.junit.platform.launcher.core.DefaultLauncher.execute(DefaultLauncher.java:85)
	at org.junit.platform.launcher.core.DelegatingLauncher.execute(DelegatingLauncher.java:47)
	at org.apache.maven.surefire.junitplatform.LazyLauncher.execute(LazyLauncher.java:56)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.execute(JUnitPlatformProvider.java:184)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invokeAllTests(JUnitPlatformProvider.java:148)
	at org.apache.maven.surefire.junitplatform.JUnitPlatformProvider.invoke(JUnitPlatformProvider.java:122)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)
	at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)
11:19:04.325 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT -- Buffer management test completed:
11:19:04.325 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Parse attempts: 3
11:19:04.325 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Successful parses: 1
11:19:04.325 [main] INFO org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT --   Success rate: {:.2f}%
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 17.75 s -- in org.springaicommunity.claude.agent.sdk.streaming.RobustStreamingIT
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   StdioTransportIntegrationIT.transportShouldHandleConcurrentMessageHandlers:297->withTransport:71->lambda$transportShouldHandleConcurrentMessageHandlers$18:312 
Expecting value to be true but was false
[INFO] 
[ERROR] Tests run: 89, Failures: 1, Errors: 0, Skipped: 0
[INFO] 
[INFO] 
[INFO] --- jacoco:0.8.11:report-integration (report-integration) @ claude-code-sdk ---
[INFO] Skipping JaCoCo execution due to missing execution data file.
[INFO] 
[INFO] --- failsafe:3.5.2:verify (default) @ claude-code-sdk ---
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary for Claude Agent SDK Parent 1.0.0-SNAPSHOT:
[INFO] 
[INFO] Claude Agent SDK Parent ............................ SUCCESS [  0.556 s]
[INFO] Claude Code SDK .................................... FAILURE [09:00 min]
[INFO] Claude Code SDK Examples ........................... SKIPPED
[INFO] Claude Code SDK Hello World Example ................ SKIPPED
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  09:01 min
[INFO] Finished at: 2025-12-11T11:19:04-08:00
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-failsafe-plugin:3.5.2:verify (default) on project claude-code-sdk: There are test failures.
[ERROR] 
[ERROR] See /home/mark/community/claude-agent-sdk-java/claude-code-sdk/target/failsafe-reports for the individual test results.
[ERROR] See dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
[ERROR] 
[ERROR] After correcting the problems, you can resume the build with the command
[ERROR]   mvn <args> -rf :claude-code-sdk
